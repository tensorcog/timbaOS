"use strict";(()=>{var e={};e.id=503,e.ids=[503],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},54411:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>P,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>l,staticGenerationAsyncStorage:()=>p});var o={};t.r(o),t.d(o,{GET:()=>i});var n=t(49303),d=t(88716),s=t(60670),a=t(87070),c=t(13538);async function i(e){try{let r=e.nextUrl.searchParams.get("productIds");if(!r)return a.NextResponse.json({error:"productIds required"},{status:400});let t=r.split(","),o=(await c.Z.productRecommendation.findMany({where:{productId:{in:t}},include:{recommendedProduct:{include:{inventory:{select:{stockLevel:!0}}}}},orderBy:{strength:"desc"},take:10})).filter(e=>!t.includes(e.recommendedProductId)).filter(e=>e.recommendedProduct.inventory.reduce((e,r)=>e+r.stockLevel,0)>0),n=new Map;o.forEach(e=>{(!n.has(e.recommendedProductId)||n.get(e.recommendedProductId).strength<e.strength)&&n.set(e.recommendedProductId,e)});let d=Array.from(n.values()).slice(0,5).map(e=>({product:{id:e.recommendedProduct.id,name:e.recommendedProduct.name,sku:e.recommendedProduct.sku,price:parseFloat(e.recommendedProduct.basePrice.toString())},strength:e.strength,reason:e.reason}));return a.NextResponse.json(d)}catch(e){return console.error("Recommendation fetch error:",e),a.NextResponse.json({error:"Failed to fetch recommendations"},{status:500})}}let u=new n.AppRouteRouteModule({definition:{kind:d.x.APP_ROUTE,page:"/api/recommendations/route",pathname:"/api/recommendations",filename:"route",bundlePath:"app/api/recommendations/route"},resolvedPagePath:"/home/monty/spruce-killer/src/app/api/recommendations/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:l}=u,h="/api/recommendations/route";function P(){return(0,s.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:p})}},13538:(e,r,t)=>{t.d(r,{Z:()=>n});var o=t(53524);let n=globalThis.prisma??new o.PrismaClient}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[276,972],()=>t(54411));module.exports=o})();