(()=>{var e={};e.id=377,e.ids=[377],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},78347:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>l}),s(75974),s(89259),s(68269),s(35866);var r=s(23191),d=s(88716),a=s(37922),i=s.n(a),o=s(95231),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);s.d(t,n);let l=["",{children:["dashboard",{children:["quotes",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,75974)),"/home/monty/spruce-killer/src/app/dashboard/quotes/[id]/edit/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,89259)),"/home/monty/spruce-killer/src/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,68269)),"/home/monty/spruce-killer/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/monty/spruce-killer/src/app/dashboard/quotes/[id]/edit/page.tsx"],u="/dashboard/quotes/[id]/edit/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:d.x.APP_PAGE,page:"/dashboard/quotes/[id]/edit/page",pathname:"/dashboard/quotes/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},29365:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,79404,23)),Promise.resolve().then(s.bind(s,54119))},72257:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},35047:(e,t,s)=>{"use strict";var r=s(77389);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},54119:(e,t,s)=>{"use strict";s.d(t,{QuoteEditForm:()=>c});var r=s(10326),d=s(17577),a=s(35047),i=s(88307),o=s(72257),n=s(98091);let l=[{minQty:1e3,discount:.15},{minQty:500,discount:.1},{minQty:100,discount:.05}];function c({quote:e,customers:t,products:s,locations:c}){let u=(0,a.useRouter)(),[m,x]=(0,d.useState)(t.find(t=>t.id===e.customerId)||null),[p,h]=(0,d.useState)(c.find(t=>t.id===e.locationId)||null),[b,g]=(0,d.useState)(e.items),[y,f]=(0,d.useState)(""),[j,v]=(0,d.useState)(e.notes||""),[N,P]=(0,d.useState)(!1),q=s.filter(e=>e.name.toLowerCase().includes(y.toLowerCase())||e.sku.toLowerCase().includes(y.toLowerCase())),w=e=>{b.find(t=>t.productId===e.id)?g(b.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1}:t)):g([...b,{productId:e.id,product:e,quantity:1,unitPrice:e.basePrice,discount:0}]),f("")},k=(e,t)=>{t<=0?g(b.filter(t=>t.productId!==e)):g(b.map(s=>{if(s.productId===e){let e=l.find(e=>t>=e.minQty),r=e?s.product.basePrice*(1-e.discount):s.product.basePrice;return{...s,quantity:t,unitPrice:r}}return s}))},I=(e,t)=>{g(b.map(s=>s.productId===e?{...s,discount:t}:s))},S=e=>{g(b.filter(t=>t.productId!==e))},F=b.reduce((e,t)=>e+(t.unitPrice*t.quantity-t.discount),0),C=m?.taxExempt?0:F*(p?.taxRate||.0825),_=async t=>{if(t.preventDefault(),!m||!p||0===b.length){alert("Please select a customer, location, and add at least one item");return}P(!0);try{(await fetch(`/api/quotes/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:b.map(e=>({productId:e.productId,quantity:e.quantity,unitPrice:e.unitPrice,discount:e.discount})),notes:j})})).ok?u.push(`/dashboard/quotes/${e.id}`):alert("Failed to update quote")}catch(e){console.error("Quote update error:",e),alert("Failed to update quote")}finally{P(!1)}};return(0,r.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Customer"}),(0,r.jsxs)("div",{className:"px-3 py-2 rounded-lg border bg-muted",children:[r.jsx("div",{className:"font-medium",children:m?.name}),r.jsx("div",{className:"text-sm text-muted-foreground",children:m?.email})]}),m?.taxExempt&&r.jsx("p",{className:"mt-2 text-sm text-green-600 font-medium",children:"Tax Exempt Customer"})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Location"}),r.jsx("div",{className:"px-3 py-2 rounded-lg border bg-muted",children:(0,r.jsxs)("div",{className:"font-medium",children:[p?.name," (",p?.code,")"]})})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Quote Items"}),(0,r.jsxs)("div",{className:"relative mb-4",children:[r.jsx(i.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),r.jsx("input",{type:"text",placeholder:"Search products to add...",value:y,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border bg-background"})]}),y&&q.length>0&&r.jsx("div",{className:"mb-4 max-h-48 overflow-auto border rounded-lg",children:q.slice(0,10).map(e=>r.jsx("button",{type:"button",onClick:()=>w(e),className:"w-full text-left p-3 hover:bg-muted transition-colors border-b last:border-b-0",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"font-medium",children:e.name}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.sku," â€¢ ",e.category]})]}),(0,r.jsxs)("div",{className:"text-lg font-semibold text-green-600",children:["$",e.basePrice.toFixed(2)]})]})},e.id))}),b.length>0&&r.jsx("div",{className:"space-y-3",children:b.map(e=>{let t=l.find(t=>e.quantity>=t.minQty),s=e.unitPrice*e.quantity-e.discount;return(0,r.jsxs)("div",{className:"p-4 rounded-lg border bg-muted/50",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("div",{className:"font-mono text-xs text-muted-foreground",children:e.product.sku}),r.jsx("div",{className:"font-medium",children:e.product.name}),t&&(0,r.jsxs)("div",{className:"text-sm text-green-600 font-medium flex items-center gap-1",children:[r.jsx(o.Z,{className:"h-3 w-3"}),"Bulk discount: ",(100*t.discount).toFixed(0),"% off"]})]}),r.jsx("button",{type:"button",onClick:()=>S(e.productId),className:"text-red-500 hover:text-red-700 p-1",children:r.jsx(n.Z,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:"Quantity"}),r.jsx("input",{type:"number",min:"1",value:e.quantity,onChange:t=>k(e.productId,parseInt(t.target.value)||0),className:"w-full px-3 py-2 rounded border bg-background"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:"Unit Price"}),(0,r.jsxs)("div",{className:"px-3 py-2 rounded border bg-muted text-sm",children:["$",e.unitPrice.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:"Item Discount ($)"}),r.jsx("input",{type:"number",min:"0",step:"0.01",value:e.discount,onChange:t=>I(e.productId,parseFloat(t.target.value)||0),className:"w-full px-3 py-2 rounded border bg-background"})]})]}),(0,r.jsxs)("div",{className:"mt-2 text-right font-semibold",children:["Subtotal: $",s.toFixed(2)]})]},e.productId)})})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Notes"}),r.jsx("textarea",{value:j,onChange:e=>v(e.target.value),placeholder:"Internal notes (optional)",className:"w-full px-3 py-2 rounded-lg border bg-background",rows:3})]}),b.length>0&&(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Quote Summary"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Subtotal:"}),(0,r.jsxs)("span",{children:["$",F.toFixed(2)]})]}),m?.taxExempt?(0,r.jsxs)("div",{className:"flex justify-between text-muted-foreground",children:[r.jsx("span",{children:"Tax (Exempt):"}),r.jsx("span",{children:"$0.00"})]}):(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("span",{children:["Tax (",(100*(p?.taxRate||0)).toFixed(2),"%):"]}),(0,r.jsxs)("span",{children:["$",C.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-xl font-bold pt-2 border-t",children:[r.jsx("span",{children:"Total:"}),(0,r.jsxs)("span",{children:["$",(F+C).toFixed(2)]})]})]}),r.jsx("button",{type:"submit",disabled:N||0===b.length,className:"w-full mt-6 py-3 rounded-lg bg-gradient-to-r from-purple-500 to-blue-600 text-white font-semibold hover:from-purple-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Updating Quote...":"Update Quote"})]})]})}},75974:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(19510),d=s(13538),a=s(58585);let i=(0,s(68570).createProxy)(String.raw`/home/monty/spruce-killer/src/components/quotes/quote-edit-form.tsx#QuoteEditForm`);var o=s(39755),n=s(57371);async function l({params:e}){let[t,s,l,c]=await Promise.all([d.Z.quote.findUnique({where:{id:e.id},include:{items:{include:{product:!0}},customer:!0,location:!0}}),d.Z.customer.findMany({select:{id:!0,name:!0,email:!0,address:!0,taxExempt:!0},orderBy:{name:"asc"}}),d.Z.product.findMany({where:{isActive:!0},select:{id:!0,name:!0,sku:!0,basePrice:!0,category:!0},orderBy:{name:"asc"}}),d.Z.location.findMany({where:{isActive:!0},select:{id:!0,name:!0,code:!0,taxRate:!0}})]);t||(0,a.notFound)();let u={quote:{id:t.id,quoteNumber:t.quoteNumber,customerId:t.customerId,locationId:t.locationId,notes:t.notes,validUntil:t.validUntil.toISOString(),items:t.items.map(e=>({productId:e.productId,product:{id:e.product.id,name:e.product.name,sku:e.product.sku,basePrice:parseFloat(e.product.basePrice.toString()),category:e.product.category},quantity:e.quantity,unitPrice:parseFloat(e.unitPrice.toString()),discount:parseFloat(e.discount.toString())}))},customers:s,products:l.map(e=>({...e,basePrice:parseFloat(e.basePrice.toString())})),locations:c.map(e=>({...e,taxRate:parseFloat(e.taxRate.toString())}))};return(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[r.jsx(n.default,{href:`/dashboard/quotes/${t.id}`,className:"p-2 rounded-full hover:bg-muted transition-colors",children:r.jsx(o.Z,{className:"h-5 w-5"})}),(0,r.jsxs)("h1",{className:"text-2xl font-semibold",children:["Edit Quote ",t.quoteNumber]})]}),r.jsx(i,{...u})]})}},13538:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var r=s(53524);let d=globalThis.prisma??new r.PrismaClient}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,99,404,267,426],()=>s(78347));module.exports=r})();