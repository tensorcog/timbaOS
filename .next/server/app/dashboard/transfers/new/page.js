(()=>{var e={};e.id=984,e.ids=[984],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},68519:(e,r,a)=>{"use strict";a.r(r),a.d(r,{GlobalError:()=>i.a,__next_app__:()=>f,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>l}),a(54195),a(89259),a(68269),a(35866);var t=a(23191),s=a(88716),n=a(37922),i=a.n(n),d=a(95231),o={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>d[e]);a.d(r,o);let l=["",{children:["dashboard",{children:["transfers",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,54195)),"/home/monty/spruce-killer/src/app/dashboard/transfers/new/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,89259)),"/home/monty/spruce-killer/src/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,68269)),"/home/monty/spruce-killer/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/monty/spruce-killer/src/app/dashboard/transfers/new/page.tsx"],u="/dashboard/transfers/new/page",f={require:a,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/dashboard/transfers/new/page",pathname:"/dashboard/transfers/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},43447:(e,r,a)=>{let t={"821f302f64185a3cdaf112a0857866b77c6d368e":()=>Promise.resolve().then(a.bind(a,22980)).then(e=>e.rejectTransfer),acdea048839c707e4bd40ecf27872d5212818ab5:()=>Promise.resolve().then(a.bind(a,22980)).then(e=>e.receiveTransfer),ad16009e80f763aa7bad7be75e3216cafbebb224:()=>Promise.resolve().then(a.bind(a,22980)).then(e=>e.createTransfer),ee08196a811c0bb044a12bbc110cd2a6f5d0bf75:()=>Promise.resolve().then(a.bind(a,22980)).then(e=>e.shipTransfer),f6030df688df6b07b569111a74edc3758834a72e:()=>Promise.resolve().then(a.bind(a,22980)).then(e=>e.approveTransfer)};async function s(e,...r){return(await t[e]()).apply(null,r)}e.exports={"821f302f64185a3cdaf112a0857866b77c6d368e":s.bind(null,"821f302f64185a3cdaf112a0857866b77c6d368e"),acdea048839c707e4bd40ecf27872d5212818ab5:s.bind(null,"acdea048839c707e4bd40ecf27872d5212818ab5"),ad16009e80f763aa7bad7be75e3216cafbebb224:s.bind(null,"ad16009e80f763aa7bad7be75e3216cafbebb224"),ee08196a811c0bb044a12bbc110cd2a6f5d0bf75:s.bind(null,"ee08196a811c0bb044a12bbc110cd2a6f5d0bf75"),f6030df688df6b07b569111a74edc3758834a72e:s.bind(null,"f6030df688df6b07b569111a74edc3758834a72e")}},56647:(e,r,a)=>{Promise.resolve().then(a.t.bind(a,79404,23)),Promise.resolve().then(a.bind(a,28633))},5983:(e,r,a)=>{"use strict";a.d(r,{C8:()=>i,LH:()=>n,bZ:()=>s,fP:()=>d,gG:()=>o}),a(15424);var t=a(46242),s=(0,t.$)("acdea048839c707e4bd40ecf27872d5212818ab5"),n=(0,t.$)("ad16009e80f763aa7bad7be75e3216cafbebb224"),i=(0,t.$)("f6030df688df6b07b569111a74edc3758834a72e"),d=(0,t.$)("821f302f64185a3cdaf112a0857866b77c6d368e"),o=(0,t.$)("ee08196a811c0bb044a12bbc110cd2a6f5d0bf75")},28633:(e,r,a)=>{"use strict";a.d(r,{TransferForm:()=>l});var t=a(10326),s=a(17577),n=a(5983),i=a(83855),d=a(98091);let o=(0,a(62881).Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function l({locations:e,products:r}){let[a,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[f,p]=(0,s.useState)([]),[m,h]=(0,s.useState)(""),[b,x]=(0,s.useState)(1),[w,v]=(0,s.useState)(""),g=e=>{let r=[...f];r.splice(e,1),p(r)},y=async e=>{if(0===f.length){alert("Please add at least one item");return}if(a===c){alert("Origin and destination must be different");return}e.set("items",JSON.stringify(f)),await (0,n.LH)(e)};return(0,t.jsxs)("form",{action:y,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Origin Location"}),(0,t.jsxs)("select",{name:"originLocationId",value:a,onChange:e=>l(e.target.value),required:!0,className:"w-full p-2 rounded-md border bg-background",children:[t.jsx("option",{value:"",children:"Select Origin"}),e.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.code," - ",e.name]},e.id))]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Destination Location"}),(0,t.jsxs)("select",{name:"destinationLocationId",value:c,onChange:e=>u(e.target.value),required:!0,className:"w-full p-2 rounded-md border bg-background",children:[t.jsx("option",{value:"",children:"Select Destination"}),e.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.code," - ",e.name]},e.id))]})]})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4 space-y-4",children:[t.jsx("h3",{className:"font-semibold text-sm",children:"Add Items"}),(0,t.jsxs)("div",{className:"flex gap-4 items-end",children:[(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Product"}),(0,t.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"w-full p-2 rounded-md border bg-background",children:[t.jsx("option",{value:"",children:"Select Product"}),r.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.sku," - ",e.name]},e.id))]})]}),(0,t.jsxs)("div",{className:"w-24 space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Quantity"}),t.jsx("input",{type:"number",min:"1",value:b,onChange:e=>x(parseInt(e.target.value)||0),className:"w-full p-2 rounded-md border bg-background"})]}),t.jsx("button",{type:"button",onClick:()=>{if(!m||b<=0)return;let e=f.findIndex(e=>e.productId===m);if(e>=0){let r=[...f];r[e].quantity+=b,p(r)}else p([...f,{productId:m,quantity:b}]);h(""),x(1)},disabled:!m||b<=0,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(i.Z,{className:"h-4 w-4"})})]}),f.length>0&&t.jsx("div",{className:"mt-4 border rounded-md overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[t.jsx("thead",{className:"bg-muted",children:(0,t.jsxs)("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left",children:"Product"}),t.jsx("th",{className:"px-4 py-2 text-right",children:"Quantity"}),t.jsx("th",{className:"px-4 py-2 w-10"})]})}),t.jsx("tbody",{children:f.map((e,a)=>{let s=r.find(r=>r.id===e.productId);return(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsxs)("td",{className:"px-4 py-2",children:[t.jsx("span",{className:"font-mono text-xs text-muted-foreground mr-2",children:s?.sku}),s?.name]}),t.jsx("td",{className:"px-4 py-2 text-right",children:e.quantity}),t.jsx("td",{className:"px-4 py-2",children:t.jsx("button",{type:"button",onClick:()=>g(a),className:"text-red-500 hover:text-red-700",children:t.jsx(d.Z,{className:"h-4 w-4"})})})]},`${e.productId}-${a}`)})})]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Notes"}),t.jsx("textarea",{name:"notes",value:w,onChange:e=>v(e.target.value),className:"w-full p-2 rounded-md border bg-background min-h-[100px]",placeholder:"Optional notes about this transfer..."})]}),t.jsx("div",{className:"flex justify-end gap-4",children:(0,t.jsxs)("button",{type:"submit",disabled:0===f.length,className:"flex items-center gap-2 px-6 py-2 bg-gradient-to-r from-purple-500 to-blue-600 text-white font-semibold rounded-lg hover:from-purple-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(o,{className:"h-4 w-4"}),"Create Transfer"]})})]})}},39755:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(27162).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},22980:(e,r,a)=>{"use strict";a.r(r),a.d(r,{approveTransfer:()=>m,createTransfer:()=>p,receiveTransfer:()=>x,rejectTransfer:()=>h,shipTransfer:()=>b});var t=a(27745);a(26461);var s=a(53524);let n=globalThis.prisma??new s.PrismaClient;var i=a(30207),d=a(74739),o=a(43153),l=a(34413),c=a(12458),u=a(52040);let f={adapter:(0,c.N)(n),session:{strategy:"jwt"},pages:{signIn:"/login"},providers:[(0,l.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await n.user.findUnique({where:{email:e.email}});if(!r||!r.password)return null;let a=await u.ZP.compare(e.password,r.password);if(!a&&e.password===r.password){let a=await u.ZP.hash(e.password,10);return await n.user.update({where:{id:r.id},data:{password:a}}),{id:r.id,name:r.name,email:r.email,role:r.role}}return a?{id:r.id,name:r.name,email:r.email,role:r.role}:null}})],callbacks:{session:async({session:e,token:r})=>(r&&(e.user.id=r.id,e.user.role=r.role),e),jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.role=r.role),e)},secret:process.env.NEXTAUTH_SECRET,debug:!0};async function p(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to create transfers");let a=await n.user.findUnique({where:{email:r.user.email}});if(!a)throw Error("User not found");let t=e.get("originLocationId"),l=e.get("destinationLocationId"),c=e.get("notes"),u=JSON.parse(e.get("items"));if(!t||!l||!u||0===u.length)throw Error("Missing required fields");if(t===l)throw Error("Origin and destination locations must be different");let p=`TRF-${Date.now()}`;await n.inventoryTransfer.create({data:{transferNumber:p,originLocationId:t,destinationLocationId:l,status:s.TransferStatus.PENDING,requestedById:a.id,notes:c,items:{create:u.map(e=>({productId:e.productId,requestedQty:e.quantity}))}}}),(0,i.revalidatePath)("/dashboard/transfers"),(0,d.redirect)("/dashboard/transfers")}async function m(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to approve transfers");let a=await n.user.findUnique({where:{email:r.user.email}});if(!a)throw Error("User not found");let t=await n.inventoryTransfer.findUnique({where:{id:e}});if(!t)throw Error("Transfer not found");if(t.status!==s.TransferStatus.PENDING)throw Error("Only pending transfers can be approved");await n.inventoryTransfer.update({where:{id:e},data:{status:s.TransferStatus.APPROVED,approvedById:a.id,approvedAt:new Date}}),(0,i.revalidatePath)("/dashboard/transfers")}async function h(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to reject transfers");if(!await n.user.findUnique({where:{email:r.user.email}}))throw Error("User not found");let a=await n.inventoryTransfer.findUnique({where:{id:e}});if(!a)throw Error("Transfer not found");if(a.status!==s.TransferStatus.PENDING)throw Error("Only pending transfers can be rejected");await n.inventoryTransfer.update({where:{id:e},data:{status:s.TransferStatus.CANCELLED}}),(0,i.revalidatePath)("/dashboard/transfers")}async function b(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to ship transfers");let a=await n.inventoryTransfer.findUnique({where:{id:e},include:{items:!0}});if(!a)throw Error("Transfer not found");if(a.status!==s.TransferStatus.APPROVED)throw Error("Only approved transfers can be shipped");for(let e of a.items){let r=await n.locationInventory.findFirst({where:{productId:e.productId,locationId:a.originLocationId}});if(!r||r.stockLevel<e.requestedQty)throw Error(`Insufficient stock for product ${e.productId} at origin location`);await n.locationInventory.update({where:{id:r.id},data:{stockLevel:r.stockLevel-e.requestedQty}})}await n.inventoryTransfer.update({where:{id:e},data:{status:s.TransferStatus.IN_TRANSIT,shippedAt:new Date}}),(0,i.revalidatePath)("/dashboard/transfers")}async function x(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to receive transfers");if(!await n.user.findUnique({where:{email:r.user.email}}))throw Error("User not found");let a=await n.inventoryTransfer.findUnique({where:{id:e},include:{items:!0}});if(!a)throw Error("Transfer not found");if(a.status!==s.TransferStatus.IN_TRANSIT)throw Error("Only in-transit transfers can be received");for(let e of a.items){let r=await n.locationInventory.findFirst({where:{productId:e.productId,locationId:a.destinationLocationId}});r?await n.locationInventory.update({where:{id:r.id},data:{stockLevel:r.stockLevel+e.requestedQty}}):await n.locationInventory.create({data:{productId:e.productId,locationId:a.destinationLocationId,stockLevel:e.requestedQty,reorderPoint:10,reorderQuantity:20}})}await n.inventoryTransfer.update({where:{id:e},data:{status:s.TransferStatus.RECEIVED,receivedAt:new Date}}),(0,i.revalidatePath)("/dashboard/transfers")}(0,a(85723).h)([p,m,h,b,x]),(0,t.j)("ad16009e80f763aa7bad7be75e3216cafbebb224",p),(0,t.j)("f6030df688df6b07b569111a74edc3758834a72e",m),(0,t.j)("821f302f64185a3cdaf112a0857866b77c6d368e",h),(0,t.j)("ee08196a811c0bb044a12bbc110cd2a6f5d0bf75",b),(0,t.j)("acdea048839c707e4bd40ecf27872d5212818ab5",x)},54195:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>o});var t=a(19510),s=a(13538);let n=(0,a(68570).createProxy)(String.raw`/home/monty/spruce-killer/src/app/dashboard/transfers/new/transfer-form.tsx#TransferForm`);var i=a(39755),d=a(57371);async function o(){let e=await s.Z.location.findMany({where:{isActive:!0},select:{id:!0,name:!0,code:!0},orderBy:{code:"asc"}}),r=await s.Z.product.findMany({where:{isActive:!0},select:{id:!0,name:!0,sku:!0},orderBy:{name:"asc"}});return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx(d.default,{href:"/dashboard/transfers",className:"p-2 rounded-full hover:bg-muted transition-colors",children:t.jsx(i.Z,{className:"h-5 w-5"})}),t.jsx("h1",{className:"text-2xl font-semibold",children:"New Inventory Transfer"})]}),t.jsx("div",{className:"rounded-xl border bg-card text-card-foreground shadow",children:t.jsx("div",{className:"p-6",children:t.jsx(n,{locations:e,products:r})})})]})}},13538:(e,r,a)=>{"use strict";a.d(r,{Z:()=>s});var t=a(53524);let s=globalThis.prisma??new t.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[276,99,404,819,426],()=>a(68519));module.exports=t})();