(()=>{var e={};e.id=551,e.ids=[551],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},37425:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>f,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>l}),t(90643),t(89259),t(68269),t(35866);var a=t(23191),s=t(88716),i=t(37922),n=t.n(i),d=t(95231),o={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>d[e]);t.d(r,o);let l=["",{children:["dashboard",{children:["transfers",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,90643)),"/home/monty/spruce-killer/src/app/dashboard/transfers/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,89259)),"/home/monty/spruce-killer/src/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,68269)),"/home/monty/spruce-killer/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/monty/spruce-killer/src/app/dashboard/transfers/page.tsx"],u="/dashboard/transfers/page",f={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/dashboard/transfers/page",pathname:"/dashboard/transfers",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},43447:(e,r,t)=>{let a={"821f302f64185a3cdaf112a0857866b77c6d368e":()=>Promise.resolve().then(t.bind(t,22980)).then(e=>e.rejectTransfer),acdea048839c707e4bd40ecf27872d5212818ab5:()=>Promise.resolve().then(t.bind(t,22980)).then(e=>e.receiveTransfer),ad16009e80f763aa7bad7be75e3216cafbebb224:()=>Promise.resolve().then(t.bind(t,22980)).then(e=>e.createTransfer),ee08196a811c0bb044a12bbc110cd2a6f5d0bf75:()=>Promise.resolve().then(t.bind(t,22980)).then(e=>e.shipTransfer),f6030df688df6b07b569111a74edc3758834a72e:()=>Promise.resolve().then(t.bind(t,22980)).then(e=>e.approveTransfer)};async function s(e,...r){return(await a[e]()).apply(null,r)}e.exports={"821f302f64185a3cdaf112a0857866b77c6d368e":s.bind(null,"821f302f64185a3cdaf112a0857866b77c6d368e"),acdea048839c707e4bd40ecf27872d5212818ab5:s.bind(null,"acdea048839c707e4bd40ecf27872d5212818ab5"),ad16009e80f763aa7bad7be75e3216cafbebb224:s.bind(null,"ad16009e80f763aa7bad7be75e3216cafbebb224"),ee08196a811c0bb044a12bbc110cd2a6f5d0bf75:s.bind(null,"ee08196a811c0bb044a12bbc110cd2a6f5d0bf75"),f6030df688df6b07b569111a74edc3758834a72e:s.bind(null,"f6030df688df6b07b569111a74edc3758834a72e")}},63884:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,79404,23)),Promise.resolve().then(t.bind(t,86493))},5983:(e,r,t)=>{"use strict";t.d(r,{C8:()=>n,LH:()=>i,bZ:()=>s,fP:()=>d,gG:()=>o}),t(15424);var a=t(46242),s=(0,a.$)("acdea048839c707e4bd40ecf27872d5212818ab5"),i=(0,a.$)("ad16009e80f763aa7bad7be75e3216cafbebb224"),n=(0,a.$)("f6030df688df6b07b569111a74edc3758834a72e"),d=(0,a.$)("821f302f64185a3cdaf112a0857866b77c6d368e"),o=(0,a.$)("ee08196a811c0bb044a12bbc110cd2a6f5d0bf75")},86493:(e,r,t)=>{"use strict";t.d(r,{TransferActions:()=>u});var a=t(10326),s=t(32933),i=t(94019);let n=(0,t(62881).Z)("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);var d=t(48705),o=t(5983),l=t(40381),c=t(17577);function u({transferId:e,status:r}){let[t,u]=(0,c.useState)(!1),f=async()=>{if(t)return;u(!0);let r=l.ZP.loading("Approving transfer...");try{await (0,o.C8)(e),l.ZP.success("Transfer approved successfully",{id:r})}catch(e){l.ZP.error(e.message||"Failed to approve transfer",{id:r})}finally{u(!1)}},p=async()=>{if(t||!confirm("Are you sure you want to reject this transfer? This action cannot be undone."))return;u(!0);let r=l.ZP.loading("Rejecting transfer...");try{await (0,o.fP)(e),l.ZP.success("Transfer rejected",{id:r})}catch(e){l.ZP.error(e.message||"Failed to reject transfer",{id:r})}finally{u(!1)}},m=async()=>{if(t)return;u(!0);let r=l.ZP.loading("Shipping transfer...");try{await (0,o.gG)(e),l.ZP.success("Transfer shipped successfully",{id:r})}catch(e){l.ZP.error(e.message||"Failed to ship transfer",{id:r})}finally{u(!1)}},b=async()=>{if(t||!confirm("Confirm receipt of this transfer? Inventory will be updated."))return;u(!0);let r=l.ZP.loading("Receiving transfer...");try{await (0,o.bZ)(e),l.ZP.success("Transfer received and inventory updated",{id:r})}catch(e){l.ZP.error(e.message||"Failed to receive transfer",{id:r})}finally{u(!1)}};return"PENDING"===r?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:f,disabled:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium bg-green-500/20 text-green-400 hover:bg-green-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[a.jsx(s.Z,{className:"h-4 w-4"}),"Approve"]}),(0,a.jsxs)("button",{onClick:p,disabled:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium bg-red-500/20 text-red-400 hover:bg-red-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[a.jsx(i.Z,{className:"h-4 w-4"}),"Reject"]})]}):"APPROVED"===r?a.jsx("div",{className:"flex gap-2",children:(0,a.jsxs)("button",{onClick:m,disabled:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[a.jsx(n,{className:"h-4 w-4"}),"Ship"]})}):"IN_TRANSIT"===r?a.jsx("div",{className:"flex gap-2",children:(0,a.jsxs)("button",{onClick:b,disabled:t,className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[a.jsx(d.Z,{className:"h-4 w-4"}),"Receive"]})}):null}},1733:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});let a=(0,t(27162).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},33515:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});let a=(0,t(27162).Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},49268:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});let a=(0,t(27162).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},14120:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});let a=(0,t(27162).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},22980:(e,r,t)=>{"use strict";t.r(r),t.d(r,{approveTransfer:()=>m,createTransfer:()=>p,receiveTransfer:()=>x,rejectTransfer:()=>b,shipTransfer:()=>h});var a=t(27745);t(26461);var s=t(53524);let i=globalThis.prisma??new s.PrismaClient;var n=t(30207),d=t(74739),o=t(43153),l=t(34413),c=t(12458),u=t(52040);let f={adapter:(0,c.N)(i),session:{strategy:"jwt"},pages:{signIn:"/login"},providers:[(0,l.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await i.user.findUnique({where:{email:e.email}});if(!r||!r.password)return null;let t=await u.ZP.compare(e.password,r.password);if(!t&&e.password===r.password){let t=await u.ZP.hash(e.password,10);return await i.user.update({where:{id:r.id},data:{password:t}}),{id:r.id,name:r.name,email:r.email,role:r.role}}return t?{id:r.id,name:r.name,email:r.email,role:r.role}:null}})],callbacks:{session:async({session:e,token:r})=>(r&&(e.user.id=r.id,e.user.role=r.role),e),jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.role=r.role),e)},secret:process.env.NEXTAUTH_SECRET,debug:!0};async function p(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to create transfers");let t=await i.user.findUnique({where:{email:r.user.email}});if(!t)throw Error("User not found");let a=e.get("originLocationId"),l=e.get("destinationLocationId"),c=e.get("notes"),u=JSON.parse(e.get("items"));if(!a||!l||!u||0===u.length)throw Error("Missing required fields");if(a===l)throw Error("Origin and destination locations must be different");let p=`TRF-${Date.now()}`;await i.inventoryTransfer.create({data:{transferNumber:p,originLocationId:a,destinationLocationId:l,status:s.TransferStatus.PENDING,requestedById:t.id,notes:c,items:{create:u.map(e=>({productId:e.productId,requestedQty:e.quantity}))}}}),(0,n.revalidatePath)("/dashboard/transfers"),(0,d.redirect)("/dashboard/transfers")}async function m(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to approve transfers");let t=await i.user.findUnique({where:{email:r.user.email}});if(!t)throw Error("User not found");let a=await i.inventoryTransfer.findUnique({where:{id:e}});if(!a)throw Error("Transfer not found");if(a.status!==s.TransferStatus.PENDING)throw Error("Only pending transfers can be approved");await i.inventoryTransfer.update({where:{id:e},data:{status:s.TransferStatus.APPROVED,approvedById:t.id,approvedAt:new Date}}),(0,n.revalidatePath)("/dashboard/transfers")}async function b(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to reject transfers");if(!await i.user.findUnique({where:{email:r.user.email}}))throw Error("User not found");let t=await i.inventoryTransfer.findUnique({where:{id:e}});if(!t)throw Error("Transfer not found");if(t.status!==s.TransferStatus.PENDING)throw Error("Only pending transfers can be rejected");await i.inventoryTransfer.update({where:{id:e},data:{status:s.TransferStatus.CANCELLED}}),(0,n.revalidatePath)("/dashboard/transfers")}async function h(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to ship transfers");let t=await i.inventoryTransfer.findUnique({where:{id:e},include:{items:!0}});if(!t)throw Error("Transfer not found");if(t.status!==s.TransferStatus.APPROVED)throw Error("Only approved transfers can be shipped");for(let e of t.items){let r=await i.locationInventory.findFirst({where:{productId:e.productId,locationId:t.originLocationId}});if(!r||r.stockLevel<e.requestedQty)throw Error(`Insufficient stock for product ${e.productId} at origin location`);await i.locationInventory.update({where:{id:r.id},data:{stockLevel:r.stockLevel-e.requestedQty}})}await i.inventoryTransfer.update({where:{id:e},data:{status:s.TransferStatus.IN_TRANSIT,shippedAt:new Date}}),(0,n.revalidatePath)("/dashboard/transfers")}async function x(e){let r=await (0,o.getServerSession)(f);if(!r||!r.user?.email)throw Error("Unauthorized: You must be logged in to receive transfers");if(!await i.user.findUnique({where:{email:r.user.email}}))throw Error("User not found");let t=await i.inventoryTransfer.findUnique({where:{id:e},include:{items:!0}});if(!t)throw Error("Transfer not found");if(t.status!==s.TransferStatus.IN_TRANSIT)throw Error("Only in-transit transfers can be received");for(let e of t.items){let r=await i.locationInventory.findFirst({where:{productId:e.productId,locationId:t.destinationLocationId}});r?await i.locationInventory.update({where:{id:r.id},data:{stockLevel:r.stockLevel+e.requestedQty}}):await i.locationInventory.create({data:{productId:e.productId,locationId:t.destinationLocationId,stockLevel:e.requestedQty,reorderPoint:10,reorderQuantity:20}})}await i.inventoryTransfer.update({where:{id:e},data:{status:s.TransferStatus.RECEIVED,receivedAt:new Date}}),(0,n.revalidatePath)("/dashboard/transfers")}(0,t(85723).h)([p,m,b,h,x]),(0,a.j)("ad16009e80f763aa7bad7be75e3216cafbebb224",p),(0,a.j)("f6030df688df6b07b569111a74edc3758834a72e",m),(0,a.j)("821f302f64185a3cdaf112a0857866b77c6d368e",b),(0,a.j)("ee08196a811c0bb044a12bbc110cd2a6f5d0bf75",h),(0,a.j)("acdea048839c707e4bd40ecf27872d5212818ab5",x)},90643:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var a=t(19510),s=t(13538),i=t(14120),n=t(33515),d=t(49268),o=t(1733),l=t(57371);let c=(0,t(68570).createProxy)(String.raw`/home/monty/spruce-killer/src/app/dashboard/transfers/transfer-actions.tsx#TransferActions`);async function u(){let e=await s.Z.inventoryTransfer.findMany({include:{originLocation:!0,destinationLocation:!0,items:{include:{product:!0}},requester:!0,approver:!0},orderBy:{requestedAt:"desc"}}),r=e=>{switch(e){case"PENDING":return"bg-yellow-500/20 text-yellow-400";case"APPROVED":return"bg-blue-500/20 text-blue-400";case"IN_TRANSIT":return"bg-purple-500/20 text-purple-400";case"RECEIVED":return"bg-green-500/20 text-green-400";case"CANCELLED":return"bg-red-500/20 text-red-400";default:return"bg-muted text-muted-foreground"}},t=e=>{switch(e){case"PENDING":return a.jsx(i.Z,{className:"h-4 w-4"});case"RECEIVED":return a.jsx(n.Z,{className:"h-4 w-4"});case"CANCELLED":return a.jsx(d.Z,{className:"h-4 w-4"});default:return a.jsx(o.Z,{className:"h-4 w-4"})}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-lg font-semibold md:text-2xl",children:"Inventory Transfers"}),a.jsx(l.default,{href:"/dashboard/transfers/new",children:a.jsx("button",{className:"px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-blue-600 text-white font-semibold hover:from-purple-600 hover:to-blue-700 transition-all",children:"New Transfer"})})]}),a.jsx("div",{className:"rounded-xl border bg-card text-card-foreground shadow",children:a.jsx("div",{className:"p-6",children:a.jsx("div",{className:"space-y-4",children:0===e.length?(0,a.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(o.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No transfers found"})]}):e.map(e=>(0,a.jsxs)("div",{className:"rounded-lg border bg-muted/50 p-4 hover:bg-muted transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"px-3 py-1 rounded bg-blue-500/20 text-blue-400 font-semibold text-sm",children:e.originLocation.code}),a.jsx(o.Z,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("div",{className:"px-3 py-1 rounded bg-purple-500/20 text-purple-400 font-semibold text-sm",children:e.destinationLocation.code})]}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.originLocation.name," â†’ ",e.destinationLocation.name]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:`flex items-center gap-1.5 px-3 py-1 rounded text-xs font-medium ${r(e.status)}`,children:[t(e.status),e.status]}),a.jsx(c,{transferId:e.id,status:e.status})]})]}),a.jsx("div",{className:"space-y-2 mb-3",children:e.items.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"font-mono text-xs text-muted-foreground",children:e.product.sku}),a.jsx("span",{children:e.product.name})]}),a.jsx("div",{className:"flex items-center gap-3",children:(0,a.jsxs)("span",{className:"font-semibold",children:[e.requestedQty," units"]})})]},e.id))}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground border-t pt-3",children:[(0,a.jsxs)("div",{children:["Requested by ",a.jsx("span",{className:"font-medium",children:e.requester?.name||"System"})," on ",new Date(e.requestedAt).toLocaleDateString()]}),e.receivedAt&&(0,a.jsxs)("div",{children:["Received on ",new Date(e.receivedAt).toLocaleDateString()]})]}),e.notes&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-muted-foreground italic",children:['"',e.notes,'"']})]},e.id))})})})]})}},13538:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});var a=t(53524);let s=globalThis.prisma??new a.PrismaClient}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,99,404,819,426],()=>t(37425));module.exports=a})();