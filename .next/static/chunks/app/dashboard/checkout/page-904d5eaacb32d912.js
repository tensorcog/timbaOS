(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{48382:function(e,t,s){Promise.resolve().then(s.bind(s,87834))},79205:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var r=s(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&s.indexOf(e)===t).join(" ")};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,r.forwardRef)((e,t)=>{let{color:s="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:d,className:c="",children:i,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:t,...n,width:a,height:a,stroke:s,strokeWidth:d?24*Number(o)/Number(a):o,className:l("lucide",c),...m},[...u.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(i)?i:[i]])}),d=(e,t)=>{let s=(0,r.forwardRef)((s,n)=>{let{className:d,...c}=s;return(0,r.createElement)(o,{ref:n,iconNode:t,className:l("lucide-".concat(a(e)),d),...c})});return s.displayName="".concat(e),s}},30401:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},95252:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},99397:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},73247:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},16275:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},82023:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]])},92369:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},32489:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},27648:function(e,t,s){"use strict";s.d(t,{default:function(){return a.a}});var r=s(72972),a=s.n(r)},99376:function(e,t,s){"use strict";var r=s(35475);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},87834:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return C}});var r=s(57437),a=s(88054),l=s(86697),n=s(2265),o=s(92369),d=s(32489),c=s(73247),i=s(99397);function u(e){let{customer:t,onSelectCustomer:s}=e,[a,l]=(0,n.useState)(!1),[u,m]=(0,n.useState)(""),[x,h]=(0,n.useState)([]),[p,f]=(0,n.useState)(!1),[b,g]=(0,n.useState)({name:"",email:"",phone:""}),j=async e=>{if(e.length<2){h([]);return}try{let t=await fetch("/api/pos/customers?q=".concat(encodeURIComponent(e))),s=await t.json();h(s)}catch(e){console.error("Failed to search customers:",e)}},v=e=>{m(e);let t=setTimeout(()=>j(e),300);return()=>clearTimeout(t)},y=async()=>{try{let e=await fetch("/api/pos/customers/walk-in",{method:"POST"}),t=await e.json();s(t),l(!1)}catch(e){console.error("Failed to create walk-in customer:",e)}},N=async()=>{try{let e=await fetch("/api/pos/customers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),t=await e.json();s(t),f(!1),l(!1),g({name:"",email:"",phone:""})}catch(e){console.error("Failed to create customer:",e)}};return t&&!a?(0,r.jsx)("div",{className:"rounded-xl border bg-card p-4",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center",children:(0,r.jsx)(o.Z,{className:"h-5 w-5 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:t.name}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:t.email}),t.taxExempt&&(0,r.jsx)("div",{className:"text-xs text-green-600 font-medium",children:"Tax Exempt"})]})]}),(0,r.jsx)("button",{onClick:()=>{s(null),l(!0)},className:"text-muted-foreground hover:text-foreground p-1",children:(0,r.jsx)(d.Z,{className:"h-4 w-4"})})]})}):p?(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("h3",{className:"font-semibold mb-4",children:"New Customer"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("input",{type:"text",placeholder:"Name *",value:b.name,onChange:e=>g({...b,name:e.target.value}),className:"w-full px-3 py-2 rounded border bg-background"}),(0,r.jsx)("input",{type:"email",placeholder:"Email *",value:b.email,onChange:e=>g({...b,email:e.target.value}),className:"w-full px-3 py-2 rounded border bg-background"}),(0,r.jsx)("input",{type:"tel",placeholder:"Phone",value:b.phone,onChange:e=>g({...b,phone:e.target.value}),className:"w-full px-3 py-2 rounded border bg-background"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:N,disabled:!b.name||!b.email,className:"flex-1 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:"Create"}),(0,r.jsx)("button",{onClick:()=>f(!1),className:"px-4 py-2 rounded border hover:bg-muted",children:"Cancel"})]})]})]}):(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("h3",{className:"font-semibold mb-3",children:"Customer"}),(0,r.jsxs)("div",{className:"relative mb-3",children:[(0,r.jsx)(c.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)("input",{type:"text",placeholder:"Search by name, email, or phone...",value:u,onChange:e=>v(e.target.value),onFocus:()=>l(!0),className:"w-full pl-9 pr-3 py-2 rounded border bg-background text-sm"})]}),x.length>0&&(0,r.jsx)("div",{className:"mb-3 max-h-40 overflow-auto space-y-1",children:x.map(e=>(0,r.jsxs)("button",{onClick:()=>{s(e),l(!1),m(""),h([])},className:"w-full text-left p-2 rounded hover:bg-muted text-sm",children:[(0,r.jsx)("div",{className:"font-medium",children:e.name}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.email})]},e.id))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:y,className:"flex-1 py-2 rounded border hover:bg-muted text-sm",children:"Walk-in"}),(0,r.jsxs)("button",{onClick:()=>f(!0),className:"flex-1 py-2 rounded border hover:bg-muted text-sm flex items-center justify-center gap-1",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),"New"]})]})]})}var m=s(95252),x=s(79205);let h=(0,x.Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var p=s(30401);let f=(0,x.Z)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),b=[{id:"CASH",label:"Cash",icon:m.Z},{id:"CREDIT_CARD",label:"Credit Card",icon:h},{id:"DEBIT_CARD",label:"Debit Card",icon:h},{id:"CHECK",label:"Check",icon:p.Z},{id:"STORE_CREDIT",label:"Store Credit",icon:f}];function g(e){let{cart:t,customer:s,locationId:a,onComplete:l,onCancel:o}=e,[c,i]=(0,n.useState)([]),[u,m]=(0,n.useState)("CASH"),[x,h]=(0,n.useState)(""),[p,f]=(0,n.useState)(""),[g,j]=(0,n.useState)(!1),v=t.reduce((e,t)=>e+(t.price*t.quantity-t.discount),0),y=c.reduce((e,t)=>e+t.amount,0),N=v-y,k=e=>{i(c.filter((t,s)=>s!==e))},w=async()=>{if(N>.01){alert("Payment incomplete");return}j(!0);try{let e=await fetch("/api/pos/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:s.id,locationId:a,items:t.map(e=>({productId:e.productId,quantity:e.quantity,price:e.price,discount:e.discount})),payments:c})});if(e.ok){let t=await e.json();alert("Order ".concat(t.orderNumber," completed!")),l()}else alert("Failed to process order")}catch(e){console.error("Checkout error:",e),alert("Failed to process order")}finally{j(!1)}},C="CASH"===u&&p?parseFloat(p)-N:0;return(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"bg-card rounded-xl border max-w-2xl w-full max-h-[90vh] overflow-auto",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Payment"}),(0,r.jsx)("button",{onClick:o,className:"p-2 hover:bg-muted rounded-full",children:(0,r.jsx)(d.Z,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"mb-6 p-6 rounded-lg bg-gradient-to-r from-purple-500/20 to-blue-500/20 border",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Amount Due"}),(0,r.jsxs)("div",{className:"text-4xl font-bold",children:["$",N.toFixed(2)]}),y>0&&(0,r.jsxs)("div",{className:"text-sm text-muted-foreground mt-2",children:["Paid: $",y.toFixed(2)," of $",v.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Payment Method"}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:b.map(e=>{let t=e.icon;return(0,r.jsxs)("button",{onClick:()=>m(e.id),className:"p-3 rounded-lg border flex flex-col items-center gap-2 transition-colors ".concat(u===e.id?"bg-purple-500/20 border-purple-500":"hover:bg-muted"),children:[(0,r.jsx)(t,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"text-sm",children:e.label})]},e.id)})})]}),"CASH"===u&&N>0&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Cash Tendered"}),(0,r.jsx)("input",{type:"number",step:"0.01",value:p,onChange:e=>f(e.target.value),className:"w-full px-4 py-3 rounded-lg border bg-background text-lg",placeholder:"0.00"}),C>0&&(0,r.jsxs)("div",{className:"mt-2 text-lg font-semibold text-green-600",children:["Change: $",C.toFixed(2)]})]}),N>0&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Amount"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"number",step:"0.01",value:x,onChange:e=>h(e.target.value),className:"flex-1 px-4 py-3 rounded-lg border bg-background",placeholder:N.toFixed(2)}),(0,r.jsx)("button",{onClick:()=>h(N.toFixed(2)),className:"px-4 py-2 rounded-lg border hover:bg-muted",children:"Exact"}),(0,r.jsx)("button",{onClick:()=>{let e=parseFloat(x);e>0&&e<=N&&(i([...c,{method:u,amount:e}]),h(""))},className:"px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:"Add"})]})]}),c.length>0&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Applied Payments"}),(0,r.jsx)("div",{className:"space-y-2",children:c.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-muted/50",children:[(0,r.jsx)("span",{children:e.method.replace("_"," ")}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("span",{className:"font-semibold",children:["$",e.amount.toFixed(2)]}),(0,r.jsx)("button",{onClick:()=>k(t),className:"text-red-500 hover:text-red-700",children:(0,r.jsx)(d.Z,{className:"h-4 w-4"})})]})]},t))})]}),(0,r.jsx)("button",{onClick:w,disabled:N>.01||g,className:"w-full py-4 rounded-lg bg-gradient-to-r from-purple-500 to-blue-600 text-white font-bold text-lg hover:from-purple-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Processing...":N>.01?"$".concat(N.toFixed(2)," Remaining"):"Complete Transaction"})]})})})}var j=s(82023);function v(){let{items:e,addItem:t}=(0,a.j)(),[s,l]=(0,n.useState)([]),[o,d]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{if(0===e.length){l([]);return}(async()=>{d(!0);try{let t=e.map(e=>e.productId).join(","),s=await fetch("/api/recommendations?productIds=".concat(t));if(s.ok){let e=await s.json();l(e)}}catch(e){console.error("Failed to fetch recommendations:",e)}finally{d(!1)}})()},[e]),0===s.length)return null;let c=e=>{switch(e){case"frequently_bought_together":return"Customers also bought";case"project_bundle":return"Complete your project";case"upsell":return"You might also like";default:return"Recommended"}};return(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,r.jsx)(j.Z,{className:"h-5 w-5 text-purple-500"}),"Recommended for You"]}),o?(0,r.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading recommendations..."}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:s.map(e=>(0,r.jsxs)("div",{className:"p-4 rounded-lg border bg-muted/50 hover:bg-muted transition-colors",children:[(0,r.jsx)("div",{className:"text-xs text-purple-600 font-medium mb-2",children:c(e.reason)}),(0,r.jsx)("div",{className:"font-mono text-xs text-muted-foreground mb-1",children:e.product.sku}),(0,r.jsx)("div",{className:"font-medium mb-2 line-clamp-2",children:e.product.name}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"text-lg font-bold text-green-600",children:["$",e.product.price.toFixed(2)]}),(0,r.jsxs)("button",{onClick:()=>t(e.product),className:"px-3 py-1.5 rounded-lg bg-gradient-to-r from-purple-500 to-blue-600 text-white text-sm font-medium hover:from-purple-600 hover:to-blue-700 transition-all flex items-center gap-1",children:[(0,r.jsx)(i.Z,{className:"h-3 w-3"}),"Add"]})]})]},e.product.id))})]})}var y=s(99376);let N=(0,x.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var k=s(16275),w=s(27648);function C(){let e=(0,y.useRouter)(),{items:t,subtotal:s,clearCart:o}=(0,a.j)(),{selectedLocation:d}=(0,l.T)(),[c,i]=(0,n.useState)(null),[m,x]=(0,n.useState)(!1),[h,p]=(0,n.useState)(.0825);(0,n.useEffect)(()=>{0===t.length&&e.push("/dashboard/products")},[t.length,e]),(0,n.useEffect)(()=>{d&&fetch("/api/locations/".concat(d)).then(e=>e.json()).then(e=>p(parseFloat(e.taxRate)||.0825)).catch(()=>p(.0825))},[d]);let f=(null==c?void 0:c.taxExempt)?0:s*h;return 0===t.length?null:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,r.jsx)(w.default,{href:"/dashboard/products",className:"p-2 rounded-full hover:bg-muted transition-colors",children:(0,r.jsx)(N,{className:"h-5 w-5"})}),(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Checkout"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,r.jsx)(u,{customer:c,onSelectCustomer:i}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,r.jsx)(k.Z,{className:"h-5 w-5"}),"Order Summary"]}),(0,r.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-muted/50",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-mono text-xs text-muted-foreground",children:e.sku}),(0,r.jsx)("div",{className:"font-medium",children:e.name}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["$",e.price.toFixed(2)," \xd7 ",e.quantity]})]}),(0,r.jsxs)("div",{className:"font-semibold",children:["$",(e.price*e.quantity-e.discount).toFixed(2)]})]},e.productId))})]})]}),(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Order Total"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{children:"Subtotal:"}),(0,r.jsxs)("span",{children:["$",s.toFixed(2)]})]}),(null==c?void 0:c.taxExempt)?(0,r.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,r.jsx)("span",{children:"Tax (Exempt):"}),(0,r.jsx)("span",{children:"$0.00"})]}):(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{children:["Tax (",(100*h).toFixed(2),"%):"]}),(0,r.jsxs)("span",{children:["$",f.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[(0,r.jsx)("span",{children:"Total:"}),(0,r.jsxs)("span",{children:["$",(s+f).toFixed(2)]})]})]}),(0,r.jsx)("button",{onClick:()=>{if(!c){alert("Please select a customer");return}x(!0)},disabled:!c,className:"w-full mt-6 py-3 rounded-lg bg-gradient-to-r from-purple-500 to-blue-600 text-white font-semibold hover:from-purple-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Proceed to Payment":"Select Customer First"})]})})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(v,{})}),m&&c&&d&&(0,r.jsx)(g,{cart:t,customer:c,locationId:d,onComplete:()=>{o(),e.push("/dashboard/orders")},onCancel:()=>x(!1)})]})}},88054:function(e,t,s){"use strict";s.d(t,{Z:function(){return n},j:function(){return o}});var r=s(57437),a=s(2265);let l=(0,a.createContext)(void 0);function n(e){let{children:t}=e,[s,n]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=localStorage.getItem("cart");if(e)try{n(JSON.parse(e))}catch(e){console.error("Failed to load cart:",e)}},[]),(0,a.useEffect)(()=>{localStorage.setItem("cart",JSON.stringify(s))},[s]);let o=e=>{n(t=>t.filter(t=>t.productId!==e))},d=s.reduce((e,t)=>e+t.quantity,0),c=s.reduce((e,t)=>e+(t.price*t.quantity-t.discount),0);return(0,r.jsx)(l.Provider,{value:{items:s,addItem:e=>{n(t=>t.find(t=>t.productId===e.id)?t.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1}:t):[...t,{productId:e.id,name:e.name,sku:e.sku,price:e.price,quantity:1,discount:0}])},removeItem:o,updateQuantity:(e,t)=>{t<=0?o(e):n(s=>s.map(s=>s.productId===e?{...s,quantity:t}:s))},updateDiscount:(e,t)=>{n(s=>s.map(s=>s.productId===e?{...s,discount:t}:s))},clearCart:()=>{n([])},itemCount:d,subtotal:c},children:t})}function o(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},86697:function(e,t,s){"use strict";s.d(t,{T:function(){return o},v:function(){return n}});var r=s(57437),a=s(2265);let l=(0,a.createContext)(void 0);function n(e){let{children:t}=e,[s,n]=(0,a.useState)(null),[o,d]=(0,a.useState)([]),[c,i]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/locations");if(e.ok){let t=await e.json();d(t);let s=localStorage.getItem("selectedLocationId");if(s){let e=t.find(e=>e.id===s);e?n(e):t.length>0&&n(t[0])}else t.length>0&&n(t[0])}}catch(e){console.error("Failed to load locations:",e)}finally{i(!1)}})()},[]),(0,r.jsx)(l.Provider,{value:{currentLocation:s,selectedLocation:(null==s?void 0:s.id)||null,availableLocations:o,setCurrentLocation:e=>{n(e),localStorage.setItem("selectedLocationId",e.id)},isLoading:c},children:t})}function o(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useLocation must be used within a LocationProvider");return e}}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=48382)}),_N_E=e.O()}]);