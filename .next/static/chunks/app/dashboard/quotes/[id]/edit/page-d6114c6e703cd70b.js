(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[377],{15814:function(e,t,s){Promise.resolve().then(s.t.bind(s,72972,23)),Promise.resolve().then(s.bind(s,52144))},79205:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var r=s(2265);let d=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&s.indexOf(e)===t).join(" ")};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,t)=>{let{color:s="currentColor",size:d=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:o="",children:c,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:t,...a,width:d,height:d,stroke:s,strokeWidth:l?24*Number(i)/Number(d):i,className:n("lucide",o),...m},[...u.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(c)?c:[c]])}),l=(e,t)=>{let s=(0,r.forwardRef)((s,a)=>{let{className:l,...o}=s;return(0,r.createElement)(i,{ref:a,iconNode:t,className:n("lucide-".concat(d(e)),l),...o})});return s.displayName="".concat(e),s}},73618:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},73247:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},18930:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},99376:function(e,t,s){"use strict";var r=s(35475);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},52144:function(e,t,s){"use strict";s.d(t,{QuoteEditForm:function(){return c}});var r=s(57437),d=s(2265),n=s(99376),a=s(73247),i=s(73618),l=s(18930);let o=[{minQty:1e3,discount:.15},{minQty:500,discount:.1},{minQty:100,discount:.05}];function c(e){let{quote:t,customers:s,products:c,locations:u}=e,m=(0,n.useRouter)(),[x,h]=(0,d.useState)(s.find(e=>e.id===t.customerId)||null),[p,b]=(0,d.useState)(u.find(e=>e.id===t.locationId)||null),[f,y]=(0,d.useState)(t.items),[g,j]=(0,d.useState)(""),[v,N]=(0,d.useState)(t.notes||""),[w,k]=(0,d.useState)(!1),C=c.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())||e.sku.toLowerCase().includes(g.toLowerCase())),I=e=>{f.find(t=>t.productId===e.id)?y(f.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1}:t)):y([...f,{productId:e.id,product:e,quantity:1,unitPrice:e.basePrice,discount:0}]),j("")},P=(e,t)=>{t<=0?y(f.filter(t=>t.productId!==e)):y(f.map(s=>{if(s.productId===e){let e=o.find(e=>t>=e.minQty),r=e?s.product.basePrice*(1-e.discount):s.product.basePrice;return{...s,quantity:t,unitPrice:r}}return s}))},q=(e,t)=>{y(f.map(s=>s.productId===e?{...s,discount:t}:s))},S=e=>{y(f.filter(t=>t.productId!==e))},E=f.reduce((e,t)=>e+(t.unitPrice*t.quantity-t.discount),0),F=(null==x?void 0:x.taxExempt)?0:E*((null==p?void 0:p.taxRate)||.0825),Q=async e=>{if(e.preventDefault(),!x||!p||0===f.length){alert("Please select a customer, location, and add at least one item");return}k(!0);try{(await fetch("/api/quotes/".concat(t.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:f.map(e=>({productId:e.productId,quantity:e.quantity,unitPrice:e.unitPrice,discount:e.discount})),notes:v})})).ok?m.push("/dashboard/quotes/".concat(t.id)):alert("Failed to update quote")}catch(e){console.error("Quote update error:",e),alert("Failed to update quote")}finally{k(!1)}};return(0,r.jsxs)("form",{onSubmit:Q,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Customer"}),(0,r.jsxs)("div",{className:"px-3 py-2 rounded-lg border bg-muted",children:[(0,r.jsx)("div",{className:"font-medium",children:null==x?void 0:x.name}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:null==x?void 0:x.email})]}),(null==x?void 0:x.taxExempt)&&(0,r.jsx)("p",{className:"mt-2 text-sm text-green-600 font-medium",children:"Tax Exempt Customer"})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Location"}),(0,r.jsx)("div",{className:"px-3 py-2 rounded-lg border bg-muted",children:(0,r.jsxs)("div",{className:"font-medium",children:[null==p?void 0:p.name," (",null==p?void 0:p.code,")"]})})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Quote Items"}),(0,r.jsxs)("div",{className:"relative mb-4",children:[(0,r.jsx)(a.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,r.jsx)("input",{type:"text",placeholder:"Search products to add...",value:g,onChange:e=>j(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border bg-background"})]}),g&&C.length>0&&(0,r.jsx)("div",{className:"mb-4 max-h-48 overflow-auto border rounded-lg",children:C.slice(0,10).map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>I(e),className:"w-full text-left p-3 hover:bg-muted transition-colors border-b last:border-b-0",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.name}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.sku," â€¢ ",e.category]})]}),(0,r.jsxs)("div",{className:"text-lg font-semibold text-green-600",children:["$",e.basePrice.toFixed(2)]})]})},e.id))}),f.length>0&&(0,r.jsx)("div",{className:"space-y-3",children:f.map(e=>{let t=o.find(t=>e.quantity>=t.minQty),s=e.unitPrice*e.quantity-e.discount;return(0,r.jsxs)("div",{className:"p-4 rounded-lg border bg-muted/50",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-mono text-xs text-muted-foreground",children:e.product.sku}),(0,r.jsx)("div",{className:"font-medium",children:e.product.name}),t&&(0,r.jsxs)("div",{className:"text-sm text-green-600 font-medium flex items-center gap-1",children:[(0,r.jsx)(i.Z,{className:"h-3 w-3"}),"Bulk discount: ",(100*t.discount).toFixed(0),"% off"]})]}),(0,r.jsx)("button",{type:"button",onClick:()=>S(e.productId),className:"text-red-500 hover:text-red-700 p-1",children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-muted-foreground",children:"Quantity"}),(0,r.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:t=>P(e.productId,parseInt(t.target.value)||0),className:"w-full px-3 py-2 rounded border bg-background"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-muted-foreground",children:"Unit Price"}),(0,r.jsxs)("div",{className:"px-3 py-2 rounded border bg-muted text-sm",children:["$",e.unitPrice.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-muted-foreground",children:"Item Discount ($)"}),(0,r.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.discount,onChange:t=>q(e.productId,parseFloat(t.target.value)||0),className:"w-full px-3 py-2 rounded border bg-background"})]})]}),(0,r.jsxs)("div",{className:"mt-2 text-right font-semibold",children:["Subtotal: $",s.toFixed(2)]})]},e.productId)})})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Notes"}),(0,r.jsx)("textarea",{value:v,onChange:e=>N(e.target.value),placeholder:"Internal notes (optional)",className:"w-full px-3 py-2 rounded-lg border bg-background",rows:3})]}),f.length>0&&(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Quote Summary"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Subtotal:"}),(0,r.jsxs)("span",{children:["$",E.toFixed(2)]})]}),(null==x?void 0:x.taxExempt)?(0,r.jsxs)("div",{className:"flex justify-between text-muted-foreground",children:[(0,r.jsx)("span",{children:"Tax (Exempt):"}),(0,r.jsx)("span",{children:"$0.00"})]}):(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("span",{children:["Tax (",(100*((null==p?void 0:p.taxRate)||0)).toFixed(2),"%):"]}),(0,r.jsxs)("span",{children:["$",F.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-xl font-bold pt-2 border-t",children:[(0,r.jsx)("span",{children:"Total:"}),(0,r.jsxs)("span",{children:["$",(E+F).toFixed(2)]})]})]}),(0,r.jsx)("button",{type:"submit",disabled:w||0===f.length,className:"w-full mt-6 py-3 rounded-lg bg-gradient-to-r from-purple-500 to-blue-600 text-white font-semibold hover:from-purple-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Updating Quote...":"Update Quote"})]})]})}}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=15814)}),_N_E=e.O()}]);