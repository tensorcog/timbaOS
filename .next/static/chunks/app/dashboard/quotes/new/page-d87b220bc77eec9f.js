(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{50575:function(e,t,s){Promise.resolve().then(s.t.bind(s,72972,23)),Promise.resolve().then(s.bind(s,57215))},79205:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var r=s(2265);let d=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&s.indexOf(e)===t).join(" ")};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,r.forwardRef)((e,t)=>{let{color:s="currentColor",size:d=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:o="",children:c,iconNode:u,...x}=e;return(0,r.createElement)("svg",{ref:t,...n,width:d,height:d,stroke:s,strokeWidth:i?24*Number(a)/Number(d):a,className:l("lucide",o),...x},[...u.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(c)?c:[c]])}),i=(e,t)=>{let s=(0,r.forwardRef)((s,n)=>{let{className:i,...o}=s;return(0,r.createElement)(a,{ref:n,iconNode:t,className:l("lucide-".concat(d(e)),i),...o})});return s.displayName="".concat(e),s}},73618:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},73247:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},18930:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},99376:function(e,t,s){"use strict";var r=s(35475);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},57215:function(e,t,s){"use strict";s.d(t,{QuoteForm:function(){return c}});var r=s(57437),d=s(2265),l=s(99376),n=s(73247),a=s(73618),i=s(18930);let o=[{minQty:1e3,discount:.15},{minQty:500,discount:.1},{minQty:100,discount:.05}];function c(e){let{customers:t,products:s,locations:c}=e,u=(0,l.useRouter)(),[x,m]=(0,d.useState)(null),[h,p]=(0,d.useState)(c[0]||null),[b,f]=(0,d.useState)([]),[g,y]=(0,d.useState)(""),[j,v]=(0,d.useState)(""),[N,w]=(0,d.useState)(""),[k,C]=(0,d.useState)(30),[I,S]=(0,d.useState)(!1),q=s.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())||e.sku.toLowerCase().includes(g.toLowerCase())),P=e=>{b.find(t=>t.productId===e.id)?f(b.map(t=>t.productId===e.id?{...t,quantity:t.quantity+1}:t)):f([...b,{productId:e.id,product:e,quantity:1,unitPrice:e.basePrice,discount:0}]),y("")},F=(e,t)=>{t<=0?f(b.filter(t=>t.productId!==e)):f(b.map(s=>{if(s.productId===e){let e=o.find(e=>t>=e.minQty),r=e?s.product.basePrice*(1-e.discount):s.product.basePrice;return{...s,quantity:t,unitPrice:r}}return s}))},E=(e,t)=>{f(b.map(s=>s.productId===e?{...s,discount:t}:s))},Q=e=>{f(b.filter(t=>t.productId!==e))},$=b.reduce((e,t)=>e+(t.unitPrice*t.quantity-t.discount),0),Z=j&&$<1e3?100:0,M=(null==x?void 0:x.taxExempt)?0:$*((null==h?void 0:h.taxRate)||.0825),L=async e=>{if(e.preventDefault(),!x||!h||0===b.length){alert("Please select a customer, location, and add at least one item");return}S(!0);try{(await fetch("/api/quotes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:x.id,locationId:h.id,items:b.map(e=>({productId:e.productId,quantity:e.quantity,unitPrice:e.unitPrice,discount:e.discount})),deliveryAddress:j||null,notes:N,validityDays:k})})).ok?u.push("/dashboard/quotes"):alert("Failed to create quote")}catch(e){console.error("Quote creation error:",e),alert("Failed to create quote")}finally{S(!1)}};return(0,r.jsxs)("form",{onSubmit:L,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Customer"}),(0,r.jsxs)("select",{value:(null==x?void 0:x.id)||"",onChange:e=>{let s=t.find(t=>t.id===e.target.value);m(s||null),(null==s?void 0:s.address)&&v(s.address)},className:"w-full px-3 py-2 rounded-lg border bg-background",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select customer..."}),t.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," - ",e.email]},e.id))]}),(null==x?void 0:x.taxExempt)&&(0,r.jsx)("p",{className:"mt-2 text-sm text-green-600 font-medium",children:"Tax Exempt Customer"})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Location"}),(0,r.jsx)("select",{value:(null==h?void 0:h.id)||"",onChange:e=>{p(c.find(t=>t.id===e.target.value)||null)},className:"w-full px-3 py-2 rounded-lg border bg-background",required:!0,children:c.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Add Products"}),(0,r.jsxs)("div",{className:"relative mb-4",children:[(0,r.jsx)(n.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,r.jsx)("input",{type:"text",placeholder:"Search products by name or SKU...",value:g,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border bg-background"})]}),g&&q.length>0&&(0,r.jsx)("div",{className:"mb-4 max-h-48 overflow-auto border rounded-lg",children:q.slice(0,10).map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>P(e),className:"w-full text-left p-3 hover:bg-muted transition-colors border-b last:border-b-0",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.name}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.sku," â€¢ ",e.category]})]}),(0,r.jsxs)("div",{className:"text-lg font-semibold text-green-600",children:["$",e.basePrice.toFixed(2)]})]})},e.id))}),b.length>0&&(0,r.jsx)("div",{className:"space-y-3",children:b.map(e=>{let t=o.find(t=>e.quantity>=t.minQty),s=e.unitPrice*e.quantity-e.discount;return(0,r.jsxs)("div",{className:"p-4 rounded-lg border bg-muted/50",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-mono text-xs text-muted-foreground",children:e.product.sku}),(0,r.jsx)("div",{className:"font-medium",children:e.product.name}),t&&(0,r.jsxs)("div",{className:"text-sm text-green-600 font-medium flex items-center gap-1",children:[(0,r.jsx)(a.Z,{className:"h-3 w-3"}),"Bulk discount: ",(100*t.discount).toFixed(0),"% off"]})]}),(0,r.jsx)("button",{type:"button",onClick:()=>Q(e.productId),className:"text-red-500 hover:text-red-700 p-1",children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-muted-foreground",children:"Quantity"}),(0,r.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:t=>F(e.productId,parseInt(t.target.value)||0),className:"w-full px-3 py-2 rounded border bg-background"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-muted-foreground",children:"Unit Price"}),(0,r.jsxs)("div",{className:"px-3 py-2 rounded border bg-muted text-sm",children:["$",e.unitPrice.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-muted-foreground",children:"Item Discount ($)"}),(0,r.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.discount,onChange:t=>E(e.productId,parseFloat(t.target.value)||0),className:"w-full px-3 py-2 rounded border bg-background"})]})]}),(0,r.jsxs)("div",{className:"mt-2 text-right font-semibold",children:["Subtotal: $",s.toFixed(2)]})]},e.productId)})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Delivery Address"}),(0,r.jsx)("textarea",{value:j,onChange:e=>v(e.target.value),placeholder:"Enter delivery address (optional)",className:"w-full px-3 py-2 rounded-lg border bg-background",rows:3}),Z>0&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-muted-foreground",children:["Delivery fee: $",Z.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Quote Settings"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Valid for (days)"}),(0,r.jsx)("input",{type:"number",min:"1",max:"90",value:k,onChange:e=>C(parseInt(e.target.value)||30),className:"w-full px-3 py-2 rounded-lg border bg-background"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Notes"}),(0,r.jsx)("textarea",{value:N,onChange:e=>w(e.target.value),placeholder:"Internal notes (optional)",className:"w-full px-3 py-2 rounded-lg border bg-background",rows:2})]})]})]})]}),b.length>0&&(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Quote Summary"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Subtotal:"}),(0,r.jsxs)("span",{children:["$",$.toFixed(2)]})]}),Z>0&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Delivery Fee:"}),(0,r.jsxs)("span",{children:["$",Z.toFixed(2)]})]}),(null==x?void 0:x.taxExempt)?(0,r.jsxs)("div",{className:"flex justify-between text-muted-foreground",children:[(0,r.jsx)("span",{children:"Tax (Exempt):"}),(0,r.jsx)("span",{children:"$0.00"})]}):(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("span",{children:["Tax (",(100*((null==h?void 0:h.taxRate)||0)).toFixed(2),"%):"]}),(0,r.jsxs)("span",{children:["$",M.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-xl font-bold pt-2 border-t",children:[(0,r.jsx)("span",{children:"Total:"}),(0,r.jsxs)("span",{children:["$",($+Z+M).toFixed(2)]})]})]}),(0,r.jsx)("button",{type:"submit",disabled:I||0===b.length||!x,className:"w-full mt-6 py-3 rounded-lg bg-gradient-to-r from-purple-500 to-blue-600 text-white font-semibold hover:from-purple-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:I?"Creating Quote...":"Create Quote"})]})]})}}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=50575)}),_N_E=e.O()}]);