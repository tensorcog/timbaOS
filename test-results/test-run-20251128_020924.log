â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Bill's Supplies - Regression Test Suite          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Started at: Fri Nov 28 02:09:24 CST 2025
Server URL: http://localhost:3000
Log file: ./test-results/test-run-20251128_020924.log

[1;33mChecking server status...[0m
[0;32mâœ“ Server is running[0m

==================================================
[0;34mRunning: RBAC Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  RBAC Regression Test Suite           â•‘
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—


=========================================
TEST: Unauthenticated User Access
=========================================
[1;33mâ„¹ INFO[0m: Testing GET /api/analytics without auth
[0;31mâœ— FAIL[0m: Unauthenticated analytics should return 401 (got: 000)
[1;33mâ„¹ INFO[0m: Testing GET /api/quotes without auth
[0;31mâœ— FAIL[0m: Unauthenticated quotes should return 401 (got: 000)

=========================================
TEST: Admin User API Access
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;31mâœ— FAIL[0m: Admin login failed: FAILED:000

=========================================
TEST: Sales User API Access
=========================================
[1;33mâ„¹ INFO[0m: Logging in as sales1@billssupplies.com
[0;31mâœ— FAIL[0m: Sales login failed: FAILED:000

=========================================
TEST: Manager User API Access
=========================================
[1;33mâ„¹ INFO[0m: Logging in as amherst.manager@billssupplies.com
[0;31mâœ— FAIL[0m: Manager login failed: FAILED:000

=========================================
TEST: Quote Creation Permissions
=========================================
[1;33mâ„¹ INFO[0m: This test validates quote creation permissions
[0;32mâœ“ PASS[0m: Quote creation test prepared (requires seed data IDs)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 1[0m
[0;31mFailed: 5[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— RBAC Tests FAILED[0m
==================================================
[0;34mRunning: Quote Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Quote Validation Regression Tests                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Quote Creation Validation
=========================================
[1;33mâ„¹ INFO[0m: Fetching test data from database...
[0;34mDEBUG[0m: Test data: {"customerId":"ace3012d-65c2-41b4-89c2-b268840a1a48","locationId":"26ec5d42-7c43-4f0d-a1b6-80462285413f","productId":"142007d5-7d2a-4f41-afb8-cb41450729f5","userId":"57f2d629-5008-496f-be9c-4656a05b27a4","productPrice":"31.99"}
[1;33mâ„¹ INFO[0m: Logging in as sales1@billssupplies.com
[0;32mâœ“ PASS[0m: Sales user login successful
[1;33mâ„¹ INFO[0m: Creating a new quote
[0;32mâœ“ PASS[0m: Quote created successfully: Q-1013

=========================================
TEST: Quote Total Calculation Validation
=========================================
[0;34mDEBUG[0m: Quote data: {"id":"2b2d01ab-949f-45da-8fe0-3c3037948fa7","quoteNumber":"Q-1012","subtotal":"159.95","taxAmount":"13.2","discountAmount":"0","deliveryFee":"0","totalAmount":"173.15","itemCount":1,"taxExempt":false,"taxRate":"0.0825"}
[1;33mâ„¹ INFO[0m: Quote totals - Subtotal: 159.95, Tax: 13.2, Discount: 0, Delivery: 0, Total: 173.15
[0;32mâœ“ PASS[0m: Quote total calculation is correct (173.15 = 173.15)

=========================================
TEST: Quote Tax Calculation
=========================================
[1;33mâ„¹ INFO[0m: No tax-exempt customer quotes found to test
[0;31mâœ— FAIL[0m: Quote tax calculation mismatch (expected: 8.25, got: 8.00)

=========================================
TEST: Quote Delivery Fee Calculation
=========================================
[1;33mâ„¹ INFO[0m: Delivery fees - With delivery: 0, Without: 4
[0;32mâœ“ PASS[0m: Quote delivery fees are being calculated and tracked

=========================================
TEST: Quote Status Transitions
=========================================
[1;33mâ„¹ INFO[0m: Quote status distribution - DRAFT: 0, PENDING: 2, SENT: 0, ACCEPTED: 2, REJECTED: 0, EXPIRED: 0
[0;32mâœ“ PASS[0m: Quote statuses are being tracked correctly

=========================================
TEST: Quote Validity Period
=========================================
[1;33mâ„¹ INFO[0m: Quote validity - Valid: 4, Expired: 0
[0;32mâœ“ PASS[0m: Quote validity periods are being tracked correctly
[1;33mâ„¹ INFO[0m: No expired quotes found to test conversion blocking

=========================================
TEST: Quote Number Generation
=========================================
[1;33mâ„¹ INFO[0m: Quote numbers - Total: 4
[0;32mâœ“ PASS[0m: All quote numbers are unique

=========================================
TEST: Quote Access Permissions
=========================================
[1;33mâ„¹ INFO[0m: Testing sales user quote filtering
[0;32mâœ“ PASS[0m: Sales user can access quotes endpoint (found 15 quotes)
[1;33mâ„¹ INFO[0m: Testing admin user quote access
[0;32mâœ“ PASS[0m: Admin can access quotes endpoint (found 20 quotes)
[0;32mâœ“ PASS[0m: Admin sees more/equal quotes than sales user (20 >= 15)
[1;33mâ„¹ INFO[0m: Testing unauthenticated quote access
[0;32mâœ“ PASS[0m: Unauthenticated users correctly blocked from quotes

=========================================
TEST: Quote to Order Conversion
=========================================
[1;33mâ„¹ INFO[0m: Testing conversion for quote: Q-1012 (status: PENDING)
[0;32mâœ“ PASS[0m: Quote Q-1012 converted to order successfully
[0;32mâœ“ PASS[0m: Converted order has correct total (173.15)
[0;32mâœ“ PASS[0m: Quote status correctly updated to ACCEPTED
[0;32mâœ“ PASS[0m: Quote correctly linked to order

=========================================
TEST: Quote Conversion Validation Rules
=========================================
[1;33mâ„¹ INFO[0m: Testing that already-converted quotes cannot be re-converted
[0;32mâœ“ PASS[0m: Already-converted quotes are correctly blocked from re-conversion
[1;33mâ„¹ INFO[0m: No rejected quotes found to test
[1;33mâ„¹ INFO[0m: No draft quotes found to test

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 16[0m
[0;31mFailed: 1[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Quote Validation Tests FAILED[0m
==================================================
[0;34mRunning: Order Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Order Validation Regression Tests    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Order Creation Validation
=========================================
[1;33mâ„¹ INFO[0m: Fetching test data from database...
[0;34mDEBUG[0m: Test data: {"customerId":"ace3012d-65c2-41b4-89c2-b268840a1a48","locationId":"26ec5d42-7c43-4f0d-a1b6-80462285413f","productId":"142007d5-7d2a-4f41-afb8-cb41450729f5","userId":"57f2d629-5008-496f-be9c-4656a05b27a4","productPrice":"31.99"}
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;32mâœ“ PASS[0m: Admin login successful
[1;33mâ„¹ INFO[0m: Testing order creation via quote conversion
[0;32mâœ“ PASS[0m: Order creation test prepared (using existing conversion flow)

=========================================
TEST: Order Total Calculation Validation
=========================================
[1;33mâ„¹ INFO[0m: Testing order total calculations with various scenarios
[0;34mDEBUG[0m: Order data: {"id":"4c7a19f8-3db5-497c-b170-5863f1ab7536","subtotal":"7497.64","taxAmount":"599.81","discountAmount":"0","deliveryFee":"104","totalAmount":"8201.45","itemCount":6,"taxExempt":false,"taxRate":"0.0825"}
[1;33mâ„¹ INFO[0m: Order totals - Subtotal: 7497.64, Tax: 599.81, Discount: 0, Delivery: 104, Total: 8201.45
[0;32mâœ“ PASS[0m: Order total calculation is correct (8201.45 = 8201.45)

=========================================
TEST: Tax Calculation Validation
=========================================
[0;32mâœ“ PASS[0m: Tax-exempt customers have zero tax amount
[0;31mâœ— FAIL[0m: Tax calculation mismatch (expected: 157.98, got: 153.19)

=========================================
TEST: Order Payment Status Validation
=========================================
[1;33mâ„¹ INFO[0m: Payment status distribution - PENDING: 778, PAID: 2226, PARTIAL: 0
[0;32mâœ“ PASS[0m: Order payment statuses are being tracked correctly

=========================================
TEST: Order Edit Validation
=========================================
[1;33mâ„¹ INFO[0m: Testing order edit for order: 4c7a19f8-3db5-497c-b170-5863f1ab7536
[1;33mâ„¹ INFO[0m: Attempting to update quantity from 17 to 18
[0;32mâœ“ PASS[0m: PENDING order can be edited successfully
[1;33mâ„¹ INFO[0m: Testing that PROCESSING orders cannot be edited
[0;32mâœ“ PASS[0m: PROCESSING orders are correctly blocked from editing

=========================================
TEST: Order Status Transitions
=========================================
[1;33mâ„¹ INFO[0m: Testing status transition for order: ccb56b51-ae9a-4d0b-8d4e-736386023ca8
[1;33mâ„¹ INFO[0m: Testing PENDING -> CONFIRMED transition via /api/orders/ccb56b51-ae9a-4d0b-8d4e-736386023ca8/confirm
[0;32mâœ“ PASS[0m: Order confirmation successful (PENDING -> PROCESSING)
[0;32mâœ“ PASS[0m: Order status correctly updated to PROCESSING in database

=========================================
TEST: Order Cancellation Validation
=========================================
[1;33mâ„¹ INFO[0m: Testing order cancellation for order: 7c05e1b2-7f29-4f90-b2a4-d95e7094cffd
[0;32mâœ“ PASS[0m: Order cancellation successful
[0;32mâœ“ PASS[0m: Order status correctly updated to CANCELLED in database

=========================================
TEST: Quote to Order Conversion Validation
=========================================
[1;33mâ„¹ INFO[0m: Testing quote to order conversion for quote: Q-1013
[0;32mâœ“ PASS[0m: Quote conversion to order successful
[0;32mâœ“ PASS[0m: Converted order has correct total amount (173.15)
[0;32mâœ“ PASS[0m: Quote status correctly updated to ACCEPTED

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 14[0m
[0;31mFailed: 1[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Order Validation Tests FAILED[0m
==================================================
[0;34mRunning: Inventory Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Inventory Validation Regression Testsâ•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Inventory Levels Tracking
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;32mâœ“ PASS[0m: Admin login successful
[0;31mâœ— FAIL[0m: No location inventory found in database

=========================================
TEST: Low Stock Detection
=========================================
[1;33mâ„¹ INFO[0m: Could not fetch low stock data

=========================================
TEST: Inventory Deduction After POS Sale
=========================================
[1;33mâ„¹ INFO[0m: No suitable inventory found for POS test
[0;32mâœ“ PASS[0m: Inventory deduction test skipped (insufficient stock)

=========================================
TEST: Multi-Location Inventory
=========================================
[0;31mâœ— FAIL[0m: Could not fetch multi-location inventory data

=========================================
TEST: Inventory Query Performance
=========================================
[0;31mâœ— FAIL[0m: No location found

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 2[0m
[0;31mFailed: 3[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Inventory Validation Tests FAILED[0m
==================================================
[0;34mRunning: POS Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  POS Validation Regression Tests      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: POS Checkout Flow
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;32mâœ“ PASS[0m: Admin login successful
[0;34mDEBUG[0m: Test data: {"locationId":"26ec5d42-7c43-4f0d-a1b6-80462285413f","customerId":"ace3012d-65c2-41b4-89c2-b268840a1a48","productId":"142007d5-7d2a-4f41-afb8-cb41450729f5","price":"31.99"}
[1;33mâ„¹ INFO[0m: Testing POS checkout for product: 
[0;32mâœ“ PASS[0m: POS checkout successful: ORD-1005
[0;32mâœ“ PASS[0m: Order type correctly set to POS
[0;32mâœ“ PASS[0m: Payment status correctly set to PAID
[0;32mâœ“ PASS[0m: Order status correctly set to COMPLETED

=========================================
TEST: Walk-in Customer Creation
=========================================
[0;32mâœ“ PASS[0m: Walk-in customer created: Walk-in 1764318059594
[0;32mâœ“ PASS[0m: Walk-in customer name format is correct

=========================================
TEST: Multiple Payment Methods (Split)
=========================================
[1;33mâ„¹ INFO[0m: No suitable test data found
[0;32mâœ“ PASS[0m: Multiple payment test skipped (no data)

=========================================
TEST: POS Tax Calculation
=========================================
[1;33mâ„¹ INFO[0m: No taxable customer found
[0;32mâœ“ PASS[0m: POS tax test skipped (no taxable customer)

=========================================
TEST: POS Products Endpoint
=========================================
[0;32mâœ“ PASS[0m: POS products endpoint accessible (found 50 products)
[0;32mâœ“ PASS[0m: Products include required fields (name, price)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 11[0m
[0;31mFailed: 0[0m
=========================================
[0;32mâœ“ ALL TESTS PASSED[0m
[0;32mâœ“ POS Validation Tests PASSED[0m
==================================================
[0;34mRunning: Customer Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Customer Validation Regression Tests â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Customer Types (RETAIL vs WHOLESALE)
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;31mâœ— FAIL[0m: Could not fetch customer type data

=========================================
TEST: Tax-Exempt Customer Status
=========================================
[0;31mâœ— FAIL[0m: Could not fetch tax exempt data

=========================================
TEST: Customer Listing
=========================================
[0;32mâœ“ PASS[0m: Customer listing accessible (found 10 customers)
[0;32mâœ“ PASS[0m: Customers include required fields (name, email)

=========================================
TEST: Customer Email Uniqueness
=========================================
[0;31mâœ— FAIL[0m: Could not fetch duplicate email data

=========================================
TEST: Walk-in Customer Generation
=========================================
[0;32mâœ“ PASS[0m: Walk-in customer created successfully: Walk-in 1764318061700
[0;31mâœ— FAIL[0m: Walk-in customer not found in database
[0;31mâœ— FAIL[0m: Walk-in customer type incorrect (expected: RETAIL, got: )

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 3[0m
[0;31mFailed: 5[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Customer Validation Tests FAILED[0m
==================================================
[0;34mRunning: Product Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Product Validation Regression Tests  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Product Listing
=========================================
[1;33mâ„¹ INFO[0m: Logging in as sales1@billssupplies.com
[0;31mâœ— FAIL[0m: Product listing failed (status: 400)
[0;34mDEBUG[0m: Response: {"error":"Location ID required"}

=========================================
TEST: Product Categories
=========================================
[0;31mâœ— FAIL[0m: Could not fetch category data

=========================================
TEST: SKU Uniqueness
=========================================
[0;31mâœ— FAIL[0m: Could not fetch SKU data

=========================================
TEST: Active/Inactive Product Status
=========================================
[0;31mâœ— FAIL[0m: Could not fetch product status data

=========================================
TEST: Product Pricing
=========================================
[0;31mâœ— FAIL[0m: Could not fetch pricing data

=========================================
TEST: Location-Specific Pricing
=========================================
[1;33mâ„¹ INFO[0m: Could not fetch location pricing data

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 0[0m
[0;31mFailed: 5[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Product Validation Tests FAILED[0m
==================================================
[0;34mRunning: Audit Log Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Audit Log Validation Regression Testsâ•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Quote Audit Log Retrieval
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[1;33mâ„¹ INFO[0m: No quotes found to test audit logs
[0;32mâœ“ PASS[0m: Quote audit test skipped (no quotes)

=========================================
TEST: Order Audit Log Retrieval
=========================================
[1;33mâ„¹ INFO[0m: No orders found to test audit logs
[0;32mâœ“ PASS[0m: Order audit test skipped (no orders)

=========================================
TEST: User Attribution in Audit Logs
=========================================
[0;31mâœ— FAIL[0m: Could not fetch audit log user data

=========================================
TEST: Audit Log Timestamp Accuracy
=========================================
[1;33mâ„¹ INFO[0m: No audit logs found to test timestamps
[0;32mâœ“ PASS[0m: Timestamp test skipped (no logs)

=========================================
TEST: Audit Log Action Types
=========================================
[1;33mâ„¹ INFO[0m: No audit log action data found

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 3[0m
[0;31mFailed: 1[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Audit Log Validation Tests FAILED[0m
==================================================
[0;34mRunning: Export Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Export Validation Regression Tests   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Export Endpoint Access
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;32mâœ“ PASS[0m: Admin login successful
[1;33mâ„¹ INFO[0m: Export endpoint status: 400 (may not be implemented yet)

=========================================
TEST: Export RBAC (Role-Based Access)
=========================================
[1;33mâ„¹ INFO[0m: Testing export access as sales user
[1;33mâ„¹ INFO[0m: Export endpoint returned status: 400
[1;33mâ„¹ INFO[0m: Testing export access as manager
[1;33mâ„¹ INFO[0m: Manager export access status: 400

=========================================
TEST: Analytics Data for Export
=========================================
[0;31mâœ— FAIL[0m: Analytics endpoint failed (status: 401)

=========================================
TEST: Export Data Completeness
=========================================
[0;31mâœ— FAIL[0m: Could not fetch data counts

=========================================
TEST: Export Performance
=========================================
[0;31mâœ— FAIL[0m: Export/analytics query failed (status: 401)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 1[0m
[0;31mFailed: 3[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Export Validation Tests FAILED[0m
==================================================
[0;34mRunning: API Conversion Tests[0m
==================================================
No suitable quote found
[0;31mâœ— API Conversion Tests FAILED[0m

==================================================
TEST SUITE SUMMARY
==================================================
[0;32mTest Suites Passed: 1[0m
[0;31mTest Suites Failed: 9[0m
==================================================
Completed at: Fri Nov 28 02:21:06 CST 2025

[0;31mâœ— SOME TEST SUITES FAILED[0m

Please review the test output above or check: ./test-results/test-run-20251128_020924.log
