â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Bill's Supplies - Regression Test Suite          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Started at: Fri Nov 28 02:46:53 CST 2025
Server URL: http://localhost:3000
Log file: ./test-results/test-run-20251128_024653.log

[1;33mChecking server status...[0m
[0;32mâœ“ Server is running[0m

==================================================
[0;34mRunning: RBAC Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  RBAC Regression Test Suite           â•‘
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—


=========================================
TEST: Unauthenticated User Access
=========================================
[1;33mâ„¹ INFO[0m: Testing GET /api/analytics without auth
[0;32mâœ“ PASS[0m: Unauthenticated user correctly blocked from analytics
[1;33mâ„¹ INFO[0m: Testing GET /api/quotes without auth
[0;32mâœ“ PASS[0m: Unauthenticated user correctly blocked from quotes

=========================================
TEST: Admin User API Access
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;32mâœ“ PASS[0m: Admin login successful
[1;33mâ„¹ INFO[0m: Testing GET /api/analytics
[0;32mâœ“ PASS[0m: Admin can access analytics endpoint
[1;33mâ„¹ INFO[0m: Testing GET /api/quotes
[0;32mâœ“ PASS[0m: Admin can access quotes endpoint (found 25 quotes)

=========================================
TEST: Sales User API Access
=========================================
[1;33mâ„¹ INFO[0m: Logging in as sales1@billssupplies.com
[0;32mâœ“ PASS[0m: Sales login successful
[1;33mâ„¹ INFO[0m: Testing GET /api/analytics (should be blocked)
[0;32mâœ“ PASS[0m: Sales user correctly blocked from analytics
[1;33mâ„¹ INFO[0m: Testing GET /api/quotes (should only see own quotes)
[0;32mâœ“ PASS[0m: Sales can access quotes endpoint (found 20 quotes)
[0;32mâœ“ PASS[0m: Sales user sees fewer quotes than admin (20 < 25) - filtering works!

=========================================
TEST: Manager User API Access
=========================================
[1;33mâ„¹ INFO[0m: Logging in as amherst.manager@billssupplies.com
[0;32mâœ“ PASS[0m: Manager login successful
[1;33mâ„¹ INFO[0m: Testing GET /api/analytics (should have access)
[0;32mâœ“ PASS[0m: Manager can access analytics endpoint
[1;33mâ„¹ INFO[0m: Testing GET /api/quotes (should see location-filtered quotes)
[0;32mâœ“ PASS[0m: Manager can access quotes endpoint (found 25 quotes)
[0;32mâœ“ PASS[0m: Manager sees more/equal quotes than sales (25 >= 20)

=========================================
TEST: Quote Creation Permissions
=========================================
[1;33mâ„¹ INFO[0m: This test validates quote creation permissions
[0;32mâœ“ PASS[0m: Quote creation test prepared (requires seed data IDs)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 14[0m
[0;31mFailed: 0[0m
=========================================
[0;32mâœ“ ALL TESTS PASSED[0m
[0;32mâœ“ RBAC Tests PASSED[0m
==================================================
[0;34mRunning: Quote Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Quote Validation Regression Tests                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Quote Creation Validation
=========================================
[1;33mâ„¹ INFO[0m: Fetching test data from database...
[0;34mDEBUG[0m: Test data: {"customerId":"ace3012d-65c2-41b4-89c2-b268840a1a48","locationId":"26ec5d42-7c43-4f0d-a1b6-80462285413f","productId":"142007d5-7d2a-4f41-afb8-cb41450729f5","userId":"57f2d629-5008-496f-be9c-4656a05b27a4","productPrice":"31.99"}
[1;33mâ„¹ INFO[0m: Logging in as sales1@billssupplies.com
[0;32mâœ“ PASS[0m: Sales user login successful
[1;33mâ„¹ INFO[0m: Creating a new quote
[0;32mâœ“ PASS[0m: Quote created successfully: Q-1015

=========================================
TEST: Quote Total Calculation Validation
=========================================
[0;34mDEBUG[0m: Quote data: {"id":"662bd09b-cdc7-44c6-8062-7667799b956f","quoteNumber":"Q-SEED-001","subtotal":"100","taxAmount":"8","discountAmount":"0","deliveryFee":"0","totalAmount":"108","itemCount":1,"taxExempt":false,"taxRate":"0.0825"}
[1;33mâ„¹ INFO[0m: Quote totals - Subtotal: 100, Tax: 8, Discount: 0, Delivery: 0, Total: 108
[0;32mâœ“ PASS[0m: Quote total calculation is correct (108 = 108)

=========================================
TEST: Quote Tax Calculation
=========================================
[1;33mâ„¹ INFO[0m: No tax-exempt customer quotes found to test
[0;31mâœ— FAIL[0m: Quote tax calculation mismatch (expected: 8.25, got: 8.00)

=========================================
TEST: Quote Delivery Fee Calculation
=========================================
[1;33mâ„¹ INFO[0m: Delivery fees - With delivery: 0, Without: 6
[0;32mâœ“ PASS[0m: Quote delivery fees are being calculated and tracked

=========================================
TEST: Quote Status Transitions
=========================================
[1;33mâ„¹ INFO[0m: Quote status distribution - DRAFT: 0, PENDING: 1, SENT: 0, ACCEPTED: 5, REJECTED: 0, EXPIRED: 0
[0;32mâœ“ PASS[0m: Quote statuses are being tracked correctly

=========================================
TEST: Quote Validity Period
=========================================
[1;33mâ„¹ INFO[0m: Quote validity - Valid: 6, Expired: 0
[0;32mâœ“ PASS[0m: Quote validity periods are being tracked correctly
[1;33mâ„¹ INFO[0m: No expired quotes found to test conversion blocking

=========================================
TEST: Quote Number Generation
=========================================
[1;33mâ„¹ INFO[0m: Quote numbers - Total: 6
[0;32mâœ“ PASS[0m: All quote numbers are unique

=========================================
TEST: Quote Access Permissions
=========================================
[1;33mâ„¹ INFO[0m: Testing sales user quote filtering
[0;32mâœ“ PASS[0m: Sales user can access quotes endpoint (found 25 quotes)
[1;33mâ„¹ INFO[0m: Testing admin user quote access
[0;32mâœ“ PASS[0m: Admin can access quotes endpoint (found 30 quotes)
[0;32mâœ“ PASS[0m: Admin sees more/equal quotes than sales user (30 >= 25)
[1;33mâ„¹ INFO[0m: Testing unauthenticated quote access
[0;32mâœ“ PASS[0m: Unauthenticated users correctly blocked from quotes

=========================================
TEST: Quote to Order Conversion
=========================================
[1;33mâ„¹ INFO[0m: Testing conversion for quote: Q-1015 (status: PENDING)
[0;32mâœ“ PASS[0m: Quote Q-1015 converted to order successfully
[0;32mâœ“ PASS[0m: Converted order has correct total (173.15)
[0;32mâœ“ PASS[0m: Quote status correctly updated to ACCEPTED
[0;32mâœ“ PASS[0m: Quote correctly linked to order

=========================================
TEST: Quote Conversion Validation Rules
=========================================
[1;33mâ„¹ INFO[0m: Testing that already-converted quotes cannot be re-converted
[0;32mâœ“ PASS[0m: Already-converted quotes are correctly blocked from re-conversion
[1;33mâ„¹ INFO[0m: No rejected quotes found to test
[1;33mâ„¹ INFO[0m: No draft quotes found to test

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 16[0m
[0;31mFailed: 1[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Quote Validation Tests FAILED[0m
==================================================
[0;34mRunning: Order Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Order Validation Regression Tests    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Order Creation Validation
=========================================
[1;33mâ„¹ INFO[0m: Fetching test data from database...
[0;34mDEBUG[0m: Test data: {"customerId":"ace3012d-65c2-41b4-89c2-b268840a1a48","locationId":"26ec5d42-7c43-4f0d-a1b6-80462285413f","productId":"142007d5-7d2a-4f41-afb8-cb41450729f5","userId":"57f2d629-5008-496f-be9c-4656a05b27a4","productPrice":"31.99"}
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;32mâœ“ PASS[0m: Admin login successful
[1;33mâ„¹ INFO[0m: Testing order creation via quote conversion
[0;32mâœ“ PASS[0m: Order creation test prepared (using existing conversion flow)

=========================================
TEST: Order Total Calculation Validation
=========================================
[1;33mâ„¹ INFO[0m: Testing order total calculations with various scenarios
[0;34mDEBUG[0m: Order data: {"id":"56e04739-639a-4f96-b9df-0a2456f2341e","subtotal":"910.78","taxAmount":"72.86","discountAmount":"45.54","deliveryFee":"61","totalAmount":"999.11","itemCount":2,"taxExempt":false,"taxRate":"0.0825"}
[1;33mâ„¹ INFO[0m: Order totals - Subtotal: 910.78, Tax: 72.86, Discount: 45.54, Delivery: 61, Total: 999.11
[0;31mâœ— FAIL[0m: Order total calculation mismatch (expected: 999.10, got: 999.11)

=========================================
TEST: Tax Calculation Validation
=========================================
[0;32mâœ“ PASS[0m: Tax-exempt customers have zero tax amount
[0;31mâœ— FAIL[0m: Tax calculation mismatch (expected: 157.98, got: 153.19)

=========================================
TEST: Order Payment Status Validation
=========================================
[1;33mâ„¹ INFO[0m: Payment status distribution - PENDING: 781, PAID: 2228, PARTIAL: 0
[0;32mâœ“ PASS[0m: Order payment statuses are being tracked correctly

=========================================
TEST: Order Edit Validation
=========================================
[1;33mâ„¹ INFO[0m: Testing order edit for order: 56e04739-639a-4f96-b9df-0a2456f2341e
[1;33mâ„¹ INFO[0m: Attempting to update quantity from 19 to 20
[0;32mâœ“ PASS[0m: PENDING order can be edited successfully
[1;33mâ„¹ INFO[0m: Testing that PROCESSING orders cannot be edited
[0;32mâœ“ PASS[0m: PROCESSING orders are correctly blocked from editing

=========================================
TEST: Order Status Transitions
=========================================
[1;33mâ„¹ INFO[0m: Testing status transition for order: e0989ae5-ca02-4878-869d-38a5883f8f01
[1;33mâ„¹ INFO[0m: Testing PENDING -> CONFIRMED transition via /api/orders/e0989ae5-ca02-4878-869d-38a5883f8f01/confirm
[0;32mâœ“ PASS[0m: Order confirmation successful (PENDING -> PROCESSING)
[0;32mâœ“ PASS[0m: Order status correctly updated to PROCESSING in database

=========================================
TEST: Order Cancellation Validation
=========================================
[1;33mâ„¹ INFO[0m: Testing order cancellation for order: 96927e80-6725-41e9-8629-e69a0874f870
[0;32mâœ“ PASS[0m: Order cancellation successful
[0;32mâœ“ PASS[0m: Order status correctly updated to CANCELLED in database

=========================================
TEST: Quote to Order Conversion Validation
=========================================
[1;33mâ„¹ INFO[0m: No convertible quotes found to test conversion
[0;32mâœ“ PASS[0m: Quote conversion test skipped (no suitable quotes)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 11[0m
[0;31mFailed: 2[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Order Validation Tests FAILED[0m
==================================================
[0;34mRunning: Inventory Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Inventory Validation Regression Testsâ•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Inventory Levels Tracking
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;32mâœ“ PASS[0m: Admin login successful
[0;34mDEBUG[0m: Location data: {"locationId":"26ec5d42-7c43-4f0d-a1b6-80462285413f","locationName":"Bills Supplies - Amherst","productId":"275c9c0a-8218-4ae2-8728-5d56ad2d4bb1","productName":"Insulation R-15 Foam Board","stockLevel":144}
[1;33mâ„¹ INFO[0m: Testing inventory for location: Bills Supplies - Amherst (Stock: 144)
[0;32mâœ“ PASS[0m: Inventory data retrieved successfully (found 400 items)
[0;32mâœ“ PASS[0m: No negative stock levels found

=========================================
TEST: Low Stock Detection
=========================================
[1;33mâ„¹ INFO[0m: Found 5 items with low stock
[0;32mâœ“ PASS[0m: Low stock detection is working (found 5 items)

=========================================
TEST: Inventory Deduction After POS Sale
=========================================
[1;33mâ„¹ INFO[0m: Current stock level: 110
[1;33mâ„¹ INFO[0m: Attempting POS checkout with 2 items
[0;32mâœ“ PASS[0m: POS checkout successful
[0;32mâœ“ PASS[0m: Inventory correctly deducted (was: 110, now: 108, expected: 108)

=========================================
TEST: Multi-Location Inventory
=========================================
[1;33mâ„¹ INFO[0m: Product found in 5 locations
[0;32mâœ“ PASS[0m: Multi-location inventory tracking is working (found in 5 locations)

=========================================
TEST: Inventory Query Performance
=========================================
[1;33mâ„¹ INFO[0m: Inventory query took 41ms
[0;32mâœ“ PASS[0m: Inventory query performance is acceptable (41ms)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 8[0m
[0;31mFailed: 0[0m
=========================================
[0;32mâœ“ ALL TESTS PASSED[0m
[0;32mâœ“ Inventory Validation Tests PASSED[0m
==================================================
[0;34mRunning: POS Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  POS Validation Regression Tests      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: POS Checkout Flow
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;32mâœ“ PASS[0m: Admin login successful
[0;34mDEBUG[0m: Test data: {"locationId":"26ec5d42-7c43-4f0d-a1b6-80462285413f","customerId":"ace3012d-65c2-41b4-89c2-b268840a1a48","productId":"142007d5-7d2a-4f41-afb8-cb41450729f5","price":"31.99"}
[1;33mâ„¹ INFO[0m: Testing POS checkout for product: 
[0;32mâœ“ PASS[0m: POS checkout successful: ORD-1008
[0;32mâœ“ PASS[0m: Order type correctly set to POS
[0;32mâœ“ PASS[0m: Payment status correctly set to PAID
[0;32mâœ“ PASS[0m: Order status correctly set to COMPLETED

=========================================
TEST: Walk-in Customer Creation
=========================================
[0;32mâœ“ PASS[0m: Walk-in customer created: Walk-in 1764319634975
[0;32mâœ“ PASS[0m: Walk-in customer name format is correct

=========================================
TEST: Multiple Payment Methods (Split)
=========================================
[1;33mâ„¹ INFO[0m: No suitable test data found
[0;32mâœ“ PASS[0m: Multiple payment test skipped (no data)

=========================================
TEST: POS Tax Calculation
=========================================
[1;33mâ„¹ INFO[0m: No taxable customer found
[0;32mâœ“ PASS[0m: POS tax test skipped (no taxable customer)

=========================================
TEST: POS Products Endpoint
=========================================
[0;32mâœ“ PASS[0m: POS products endpoint accessible (found 50 products)
[0;32mâœ“ PASS[0m: Products include required fields (name, price)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 11[0m
[0;31mFailed: 0[0m
=========================================
[0;32mâœ“ ALL TESTS PASSED[0m
[0;32mâœ“ POS Validation Tests PASSED[0m
==================================================
[0;34mRunning: Customer Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Customer Validation Regression Tests â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Customer Types (RETAIL vs WHOLESALE)
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[1;33mâ„¹ INFO[0m: Customer types - RETAIL: 157, WHOLESALE: 44
[0;32mâœ“ PASS[0m: Customer types are being tracked correctly

=========================================
TEST: Tax-Exempt Customer Status
=========================================
[1;33mâ„¹ INFO[0m: Tax status - Exempt: 14, Non-exempt: 243
[0;32mâœ“ PASS[0m: Tax-exempt status is being tracked correctly

=========================================
TEST: Customer Listing
=========================================
[0;32mâœ“ PASS[0m: Customer listing accessible (found 10 customers)
[0;32mâœ“ PASS[0m: Customers include required fields (name, email)

=========================================
TEST: Customer Email Uniqueness
=========================================
[0;31mâœ— FAIL[0m: Could not fetch duplicate email data

=========================================
TEST: Walk-in Customer Generation
=========================================
[0;32mâœ“ PASS[0m: Walk-in customer created successfully: Walk-in 1764319637975
[0;32mâœ“ PASS[0m: Walk-in customer saved to database
[0;32mâœ“ PASS[0m: Walk-in customer type is RETAIL

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 7[0m
[0;31mFailed: 1[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Customer Validation Tests FAILED[0m
==================================================
[0;34mRunning: Product Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Product Validation Regression Tests  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Product Listing
=========================================
[1;33mâ„¹ INFO[0m: Logging in as sales1@billssupplies.com
node:internal/process/promises:391
    triggerUncaughtException(err, true /* fromPromise */);
    ^

Error: Transform failed with 1 error:
/eval.ts:7:4: ERROR: Unexpected "}"
    at failureErrorWithLog (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:1467:15)
    at /home/monty/spruce-killer/node_modules/esbuild/lib/main.js:736:50
    at responseCallbacks.<computed> (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:603:9)
    at handleIncomingPacket (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:658:12)
    at Socket.readFromStdout (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:581:7)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:191:23) {
  errors: [
    {
      detail: undefined,
      id: '',
      location: {
        column: 4,
        file: '/eval.ts',
        length: 1,
        line: 7,
        lineText: '    })();',
        namespace: '',
        suggestion: ''
      },
      notes: [],
      pluginName: '',
      text: 'Unexpected "}"'
    }
  ],
  warnings: []
}

Node.js v20.19.6
[0;31mâœ— FAIL[0m: Product listing failed (status: 400)
[0;34mDEBUG[0m: Response: {"error":"Location ID required"}

=========================================
TEST: Product Categories
=========================================
node:internal/process/promises:391
    triggerUncaughtException(err, true /* fromPromise */);
    ^

Error: Transform failed with 1 error:
/eval.ts:17:4: ERROR: Unexpected "}"
    at failureErrorWithLog (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:1467:15)
    at /home/monty/spruce-killer/node_modules/esbuild/lib/main.js:736:50
    at responseCallbacks.<computed> (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:603:9)
    at handleIncomingPacket (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:658:12)
    at Socket.readFromStdout (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:581:7)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:191:23) {
  errors: [
    {
      detail: undefined,
      id: '',
      location: {
        column: 4,
        file: '/eval.ts',
        length: 1,
        line: 17,
        lineText: '    })();',
        namespace: '',
        suggestion: ''
      },
      notes: [],
      pluginName: '',
      text: 'Unexpected "}"'
    }
  ],
  warnings: []
}

Node.js v20.19.6
[0;31mâœ— FAIL[0m: Could not fetch category data

=========================================
TEST: SKU Uniqueness
=========================================
node:internal/process/promises:391
    triggerUncaughtException(err, true /* fromPromise */);
    ^

Error: Transform failed with 1 error:
/eval.ts:18:4: ERROR: Unexpected "}"
    at failureErrorWithLog (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:1467:15)
    at /home/monty/spruce-killer/node_modules/esbuild/lib/main.js:736:50
    at responseCallbacks.<computed> (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:603:9)
    at handleIncomingPacket (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:658:12)
    at Socket.readFromStdout (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:581:7)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:191:23) {
  errors: [
    {
      detail: undefined,
      id: '',
      location: {
        column: 4,
        file: '/eval.ts',
        length: 1,
        line: 18,
        lineText: '    })();',
        namespace: '',
        suggestion: ''
      },
      notes: [],
      pluginName: '',
      text: 'Unexpected "}"'
    }
  ],
  warnings: []
}

Node.js v20.19.6
[0;31mâœ— FAIL[0m: Could not fetch SKU data

=========================================
TEST: Active/Inactive Product Status
=========================================
node:internal/process/promises:391
    triggerUncaughtException(err, true /* fromPromise */);
    ^

Error: Transform failed with 1 error:
/eval.ts:8:4: ERROR: Unexpected "}"
    at failureErrorWithLog (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:1467:15)
    at /home/monty/spruce-killer/node_modules/esbuild/lib/main.js:736:50
    at responseCallbacks.<computed> (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:603:9)
    at handleIncomingPacket (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:658:12)
    at Socket.readFromStdout (/home/monty/spruce-killer/node_modules/esbuild/lib/main.js:581:7)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:191:23) {
  errors: [
    {
      detail: undefined,
      id: '',
      location: {
        column: 4,
        file: '/eval.ts',
        length: 1,
        line: 8,
        lineText: '    })();',
        namespace: '',
        suggestion: ''
      },
      notes: [],
      pluginName: '',
      text: 'Unexpected "}"'
    }
  ],
  warnings: []
}

Node.js v20.19.6
[0;31mâœ— FAIL[0m: Could not fetch product status data

=========================================
TEST: Product Pricing
=========================================
[1;33mâ„¹ INFO[0m: Product has base price: 31.99
[0;32mâœ“ PASS[0m: Product has valid base price (31.99)
[0;32mâœ“ PASS[0m: Product cost tracking is available

=========================================
TEST: Location-Specific Pricing
=========================================
[1;33mâ„¹ INFO[0m: No location-specific pricing found (using base prices only)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 2[0m
[0;31mFailed: 4[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Product Validation Tests FAILED[0m
==================================================
[0;34mRunning: Audit Log Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Audit Log Validation Regression Testsâ•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Quote Audit Log Retrieval
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[1;33mâ„¹ INFO[0m: Testing audit logs for quote: 662bd09b-cdc7-44c6-8062-7667799b956f
[0;32mâœ“ PASS[0m: Audit logs retrieved successfully (found 0 logs)
[0;31mâœ— FAIL[0m: Audit logs missing required fields

=========================================
TEST: Order Audit Log Retrieval
=========================================
[1;33mâ„¹ INFO[0m: Testing audit logs for order: d55ce6d9-44da-4fb6-9297-4e42c3f6c1df
[0;32mâœ“ PASS[0m: Order audit logs retrieved successfully (found 0 logs)

=========================================
TEST: User Attribution in Audit Logs
=========================================
[0;32mâœ“ PASS[0m: Audit logs include user attribution (5 logs with users)

=========================================
TEST: Audit Log Timestamp Accuracy
=========================================
[0;32mâœ“ PASS[0m: Audit log timestamps are being recorded (found 10 recent logs)

=========================================
TEST: Audit Log Action Types
=========================================
[1;33mâ„¹ INFO[0m: Found 4 unique action types across 28 logs
[0;32mâœ“ PASS[0m: Audit logs capture various action types (4 types)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 5[0m
[0;31mFailed: 1[0m
=========================================
[0;31mâœ— SOME TESTS FAILED[0m
[0;31mâœ— Audit Log Validation Tests FAILED[0m
==================================================
[0;34mRunning: Export Validation Tests[0m
==================================================
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Export Validation Regression Tests   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


=========================================
TEST: Export Endpoint Access
=========================================
[1;33mâ„¹ INFO[0m: Logging in as admin@billssupplies.com
[0;32mâœ“ PASS[0m: Admin login successful
[1;33mâ„¹ INFO[0m: Export endpoint status: 400 (may not be implemented yet)

=========================================
TEST: Export RBAC (Role-Based Access)
=========================================
[1;33mâ„¹ INFO[0m: Testing export access as sales user
[1;33mâ„¹ INFO[0m: Export endpoint returned status: 400
[1;33mâ„¹ INFO[0m: Testing export access as manager
[1;33mâ„¹ INFO[0m: Manager export access status: 400

=========================================
TEST: Analytics Data for Export
=========================================
[0;32mâœ“ PASS[0m: Analytics data is accessible for export
[0;32mâœ“ PASS[0m: Analytics data includes key exportable metrics

=========================================
TEST: Export Data Completeness
=========================================
[1;33mâ„¹ INFO[0m: Data available for export - Quotes: 6, Orders: 3011, Customers: 258, Products: 200
[0;32mâœ“ PASS[0m: All data types available for export

=========================================
TEST: Export Performance
=========================================
[1;33mâ„¹ INFO[0m: Export/analytics query took 432ms
[0;32mâœ“ PASS[0m: Export performance is acceptable (432ms < 10s)

=========================================
TEST SUMMARY
=========================================
[0;32mPassed: 5[0m
[0;31mFailed: 0[0m
=========================================
[0;32mâœ“ ALL TESTS PASSED[0m
[0;32mâœ“ Export Validation Tests PASSED[0m
==================================================
[0;34mRunning: API Conversion Tests[0m
==================================================
Logging in as admin...
[1;33mNo suitable quote found for conversion test[0m
[0;32mâœ“ API Conversion Tests PASSED[0m

==================================================
TEST SUITE SUMMARY
==================================================
[0;32mTest Suites Passed: 5[0m
[0;31mTest Suites Failed: 5[0m
==================================================
Completed at: Fri Nov 28 02:47:26 CST 2025

[0;31mâœ— SOME TEST SUITES FAILED[0m

Please review the test output above or check: ./test-results/test-run-20251128_024653.log
